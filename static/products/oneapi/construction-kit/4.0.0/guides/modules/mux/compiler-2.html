<!DOCTYPE html>
<html lang="en-US" class="">

<!-- Mirrored from 127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/compiler by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 22 Sep 2025 18:52:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <!-- Basics -->
    <title>ComputeMux Compiler - Guides - oneAPI Construction Kit - Products - Codeplay Developer</title>
    <meta name="description" content="Read the 'ComputeMux Compiler' for oneAPI Construction Kit 4.0.0 developer guide." />
    <meta name="keywords" content="guides, tutorials, guide, oneapi, construction, kit, risc-v, arm" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Open Graph -->
    <meta name="title" property="og:title" content="ComputeMux Compiler - Guides - oneAPI Construction Kit - Products - Codeplay Developer" />
    <meta name="type" property="og:type" content="website" />
    <meta name="image" property="og:image" content="http://127.0.0.1/assets/img/og-header.png" />
    <meta name="url" property="og:url" content="http://127.0.0.1/" />
    <meta name="description" property="og:description" content="Read the 'ComputeMux Compiler' for oneAPI Construction Kit 4.0.0 developer guide." />

    <!-- Fonts -->
    <link href="http://127.0.0.1/assets/css/material.css"
          rel="stylesheet preload prefetch"
          as="style" />

    <!-- Fav icon -->
    <link rel="icon" type="image/png" href="http://127.0.0.1/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="http://127.0.0.1/favicon.svg" />
    <link rel="shortcut icon" href="http://127.0.0.1/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="http://127.0.0.1/apple-touch-icon.png" />

    <link type="text/css"
          href="http://127.0.0.1/assets/css/responsive.css"
          rel="stylesheet"/>

    <script src="https://cdn.usefathom.com/script.js" data-site="XBWVDDFP" defer></script>

    <!-- Stylesheets -->
    <link type="text/css"
          href="http://127.0.0.1/assets/css/jquery.cookiepolicyprompt.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="http://127.0.0.1/assets/css/jquery.popupdialog.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="http://127.0.0.1/assets/css/dialogs.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="http://127.0.0.1/assets/css/Pages/IndexPage.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="http://127.0.0.1/assets/css/Pages/Guides/GuidePageLayout.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="http://127.0.0.1/assets/css/Pages/Guides/GuidePageFormatting.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="http://127.0.0.1/assets/css/Pages/Guides/GuidePage.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="http://127.0.0.1/assets/css/Pages/Products/OneApi/ConstructionKit/OneApiConstructionKitShared.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="http://127.0.0.1/assets/css/Pages/Products/OneApi/ConstructionKit/Guide/OneApiConstructionKitGuidePage.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="http://127.0.0.1/assets/css/Pages/Products/OneApi/ConstructionKit/Guide/OneApiConstructionKitGuidePage.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>

    <!-- Scripts -->
    <script src="http://127.0.0.1/assets/js/jquery-3.6.3.min.js"></script>
    <script src="http://127.0.0.1/assets/js/jquery.copyright.js"></script>
    <script src="http://127.0.0.1/assets/js/jquery.cookiepolicyprompt.js"></script>
    <script src="http://127.0.0.1/assets/js/jquery.popupdialog.js"></script>
    <script src="http://127.0.0.1/assets/js/Pages/IndexPage.script.js"></script>
    <script src="http://127.0.0.1/assets/js/highlight.min.js"></script>
    <script src="http://127.0.0.1/assets/js/Pages/Guides/jquery.headingsinfocus.js"></script>
    <script src="http://127.0.0.1/assets/js/Pages/Guides/togglebutton.js"></script>
    <script src="http://127.0.0.1/assets/js/Pages/Guides/jquery.resizable.js"></script>
    <script src="http://127.0.0.1/assets/js/Pages/Guides/GuidePage.script.js"></script>

    <script>
        document.querySelectorAll('link').forEach((el) => {this.onload=null;this.rel='stylesheet';});
    </script>
</head>
<body data-deprecated="">

<!-- Header -->
<header>
    <nav class="main">
        <div>
            <a aria-label="Navigation Bar Logo" href="http://127.0.0.1/">
                <div id="codeplay-logo"></div>
            </a>
        </div>
        <div>
            <a title="Click to change production selection">
                <div>
                    <h2>Product</h2>
                    <h1>oneAPI Construction Kit</h1>
                </div>
            </a>
        </div>
        <div>
            <ul>
                <li >
                    <a href="http://127.0.0.1/products/oneapi/construction-kit/home" >
                        <div>

                            <span class="icon material-icons">home</span>

                            <div>Home</div>
                        </div>
                    </a>
                </li>
                <li  class="selected" >
                    <a href="http://127.0.0.1/products/oneapi/construction-kit/guides/" >
                        <div>

                            <span class="icon material-icons">menu_book</span>

                            <div>Guides</div>
                        </div>
                    </a>
                </li>
                <li >
                    <a href="https://github.com/codeplaysoftware/oneapi-construction-kit" target="_blank">
                        <div>

                            <span class="icon material-icons">local_library</span>

                            <div>Repository</div>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <div>
            <ul>
                <li>
                    <a href="http://127.0.0.1/support/" title="Get Support">
                        <span class="material-icons">help_outline</span>
                    </a>
                </li>
                <li>
                    <a id="burger"
                       title="Show Navigation Menu">
                        <span class="material-icons">menu</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- The burger menu, designed for mobile -->
    <div id="burger-menu">
        <ul>
            <li>
                <h1>oneAPI Menu</h1>
                <ul>
                    <li >
                        <a href="http://127.0.0.1/products/oneapi/construction-kit/home"
                           >Home</a>
                    </li>
                    <li  class="selected" >
                        <a href="http://127.0.0.1/products/oneapi/construction-kit/guides/"
                           >Guides</a>
                    </li>
                    <li >
                        <a href="https://github.com/codeplaysoftware/oneapi-construction-kit"
                           target="_blank">Repository</a>
                    </li>
                </ul>
            </li>
            <li>
                <h1>Main Menu</h1>
                <ul>
                    <li>
                        <a href="http://127.0.0.1/">Home</a>
                    </li>
                    <li>
                        <h1>Products</h1>
                        <ul>
                            <li>
                                <a href="http://127.0.0.1/products/computecpp/ce/">ComputeCpp CE</a>
                            </li>
                            <li>
                                <a href="http://127.0.0.1/products/computecpp/pe/">ComputeCpp PE</a>
                            </li>
                            <li>
                                <a href="http://127.0.0.1/products/computesuitercar/ce/">ComputeSuite for R-Car CE</a>
                            </li>
                            <li>
                                <a href="http://127.0.0.1/products/computesuitercar/pe/">ComputeSuite for R-Car PE</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="http://127.0.0.1/cookies">Cookie Policy</a>
                    </li>
                    <li>
                        <a href="https://codeplay.com/support/contact">Contact Us</a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</header>

<!-- Main element -->
<main>

    <!-- File Container -->
<div class="layout-file guide" id="modules-mux-compiler">
    <!-- Side Menu -->
    <div class="sticky file-menu-container styled-scroller">
       <div class="nav-padding">
           <!-- Title & Version Selector -->
           <div class="header">
               <h1 class="file-container-title">
                   <span class="material-icons">menu_book</span>Guides
               </h1>
               <div>
                   <!-- Version Selector -->
                   <div class="version-selector ">
                       <div><span class="material-icons">history</span>4.0.0</div>
                       <ul>
                           <li><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/compiler">4.0.0</a></li>
                           <li><a href="http://127.0.0.1/products/oneapi/construction-kit/3.0.0/guides/modules/mux/compiler">3.0.0</a></li>
                           <li><a href="http://127.0.0.1/products/oneapi/construction-kit/2.0.0/guides/modules/mux/compiler">2.0.0</a></li>
                       </ul>
                       <ul>
                           <li><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/compiler">4.0.0</a></li>
                           <li><a href="http://127.0.0.1/products/oneapi/construction-kit/3.0.0/guides/modules/mux/compiler">3.0.0</a></li>
                           <li><a href="http://127.0.0.1/products/oneapi/construction-kit/2.0.0/guides/modules/mux/compiler">2.0.0</a></li>
                       </ul>
                       <ul>
                           <li><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/compiler">4.0.0</a></li>
                           <li><a href="http://127.0.0.1/products/oneapi/construction-kit/3.0.0/guides/modules/mux/compiler">3.0.0</a></li>
                           <li><a href="http://127.0.0.1/products/oneapi/construction-kit/2.0.0/guides/modules/mux/compiler">2.0.0</a></li>
                       </ul>
                   </div>
               </div>
           </div>
           <!-- Menu -->
           <ol class="file-menu">
               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/index.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Welcome to oneAPI Construction Kit’s documentation!</a><ol></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>oneAPI Construction Kit Overview</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/preface.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Preface</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/introduction.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Introduction</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/introduction/architecture.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>oneAPI Construction Kit Architecture</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/introduction/compiler-view.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Compiler View</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/hardware.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Mapping ComputeMux to Hardware</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/hardware/memory-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Memory Requirements</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/hardware/atomic-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Atomic Requirements</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/hardware/floating-point-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Floating-Point Requirements</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/hardware/synchronization-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Synchronization Requirements</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/runtime.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Runtime Information</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/runtime/computemux-runtime.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Runtime</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/runtime/driver-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Driver Requirements</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/runtime/supported-toolchains.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Supported Toolchains</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/compiler.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Compiler Information</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/compiler/computemux-compiler.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Compiler</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/compiler/ir.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Intermediate Representation</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/compiler/supported-llvm-versions.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Supported LLVM Versions</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/compiler/non-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Compiler Non-Requirements</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/example-scenarios.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Example Hardware Feature Scenarios</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/example-scenarios/mapping-custom-instructions-to-builtin-functions.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Mapping Custom Instructions To Builtin Functions</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/example-scenarios/mapping-custom-ip-blocks-to-builtin-kernels.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Mapping Custom IP Blocks To Builtin Kernels</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/example-scenarios/how-to-support-large-scratchpad-memories.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>How To Support Large Scratchpad Memories</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/example-scenarios/mapping-algorithms-to-vector-hardware.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Mapping Algorithms To Vector Hardware</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/example-scenarios/refsi-in-kernel-dma.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>RefSi In-Kernel DMA for RISC-V</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/toolkit.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>oneAPI Construction Kit</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/new-target-quick-start.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Creating a New ComputeMux Target: Quick Start</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Tutorials</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-a-new-hal.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Creating a New HAL</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-new-hal/initial-setup.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Initial Setup</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-new-hal/kernel-compilation.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Kernel Compilation</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-new-hal/runing-clik-tests.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Running clik Tests</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-new-hal/skeleton-hal-overview.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Overview of the Skeleton HAL Code</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-new-hal/implementing-hal-operations.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Implementing HAL Operations</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-a-new-mux-target.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Creating a New ComputeMux Target</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-a-new-mux-target/running-new-target-script.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Running the create_target.py Script</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-a-new-mux-target/building-and-running-tests.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Building and Running Tests</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-a-new-mux-target/adapting-target-pass-pipeline.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Adapting the Pass Pipeline for the Target</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/tutorials/creating-a-new-mux-target/extending-it-further.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Extending it Further</a><ol></ol></li></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/reference-silicon.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Codeplay Reference Silicon</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/reference-silicon/overview.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Codeplay Reference Silicon Overview</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/reference-silicon/command-processor.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Command Processor Reference</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/reference-silicon/dma-controller.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>DMA Controller Reference</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/reference-silicon/dma-programming-guide.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>DMA Programming Guide</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/reference-silicon/driver-interface.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>RefSi Driver Interface</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/overview/reference-silicon/mapping-opencl-to-refsi.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>How The Platform Maps to SYCL and OpenCL</a><ol></ol></li></ol></li></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/getting-started.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Getting Started</a><ol></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/specifications.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Specifications</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/specifications/versioning.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Versioning Scheme</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/specifications/mux-runtime-spec.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Runtime Specification</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/specifications/mux-compiler-spec.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Compiler Specification</a><ol></ol></li></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/developer-guide.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Developer Guide</a><ol></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/tutorials.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Tutorials</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/tutorials/adding-a-custom-builtins-extension.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Adding A Custom Builtins Extension</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/tutorials/custom-lowering-work-item-builtins.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Custom Lowering Work-Item Builtins</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/tutorials/adding-target-specific-metadata.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Adding Target-Specific Metadata</a><ol></ol></li></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/design.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Design</a><ol></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>OpenCL</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/cmake.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>OpenCL CMake</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/computemux_mapping.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>How OpenCL Concepts Are Mapped Onto ComputeMux</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/extension.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>OpenCL Extensions</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/extension/cl_codeplay_kernel_debug.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Kernel Debug - cl_codeplay_kernel_debug</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/extension/cl_codeplay_extra_build_options.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Extra Build Options - cl_codeplay_extra_build_options</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/extension/cl_codeplay_kernel_exec_info.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Kernel Exec Info - cl_codeplay_kernel_exec_info</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/extension/cl_codeplay_performance_counters.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Performance Counters - cl_codeplay_performance_counters</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/extension/cl_codeplay_soft_math.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Soft Math - cl_codeplay_soft_math</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/extension/cl_codeplay_wfv.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Whole Function Vectorization - cl_codeplay_wfv</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/extension/cl_intel_unified_shared_memory.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>USM - cl_intel_unified_shared_memory</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/extension/cl_intel_required_subgroup_size.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Required subgroup sizes for kernels  - cl_intel_required_subgroup_size</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/external-extensions.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>OpenCL External Extensions</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/icd-loader.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>OpenCL ICD Loader</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/intercept.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>OpenCL Intercept Layer</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/tools.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Tools</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/test.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Tests</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/test/unitcl.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>UnitCL</a><ol></ol></li></ol></li></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/vk.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Vulkan</a><ol></ol></li>               <li class="selected"><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Modules</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/builtins.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Builtins</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/builtins/abacus.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Abacus</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/builtins/libimg.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Image Library</a><ol></ol></li></ol></li><li class="selected"><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>ComputeMux</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/changes.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Change Log</a><ol></ol></li><li class="selected focused"><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/compiler.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Compiler</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/cmake.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>CMake</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/bumping-the-spec.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Bumping the Specification Version</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/host.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Host CPU</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/targets/host/extension/cl_codeplay_host_builtins.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>cl_codeplay_host_builtins</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/targets/host/extension/cl_codeplay_set_threads.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>cl_codeplay_set_threads</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/targets/host/lit.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Host lit test suite</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/targets/host/debug.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Host Debug Features</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/riscv.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>RISC-V</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/compiler.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Compiler</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/compiler/overview.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Overview</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/compiler/utils.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Compiler Utilities</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/compiler/tools.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Tools</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/compiler/tools/muxc.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>muxc</a><ol></ol></li></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/loader.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ELF loader</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/vecz.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Vecz</a><ol><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/vecz/vecz.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Vecz Documentation</a><ol></ol></li></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/spirv-ll.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>spirv-ll</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/debug.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Debug Module</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/cargo.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Cargo Module</a><ol></ol></li><li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/metadata.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Metadata API</a><ol></ol></li></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/cmake.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>CMake Development</a><ol></ol></li>               <li class=""><a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/scripts.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Scripts</a><ol></ol></li>           </ol>
       </div>
    </div>
    <!-- Core Content -->
    <div>
        <!-- File Content -->
        <div id="content-container" class="nav-padding">
            <article class="file-content-container">
                <header>
                    <!-- Deprecated Notice -->

                    <div class="title">
                        <a class="header-link" href="#computemux-compiler">
                            <h1>ComputeMux Compiler</h1>
                        </a>
                        <div>
                            <a href="#rate" title="Rate this guide">
                                <i class="material-icons">thumb_up</i>
                            </a>

                            <a target="_blank" href="https://github.com/codeplaysoftware/oneapi-construction-kit/blob/main/doc/modules/mux/compiler.rst" rel="noopener" title="Contribute to this guide">
                                <i class="material-icons">edit</i>
                            </a>

                            <a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/cmake" title="Goto the next guide">
                                <i class="material-icons">arrow_forward_ios</i>
                            </a>
                        </div>
                    </div>

                </header>

                <div class="formatted-text">
                    <a id="top"></a>
                    <html><body><div class="document">
<div>
<div class="section" id="computemux-compiler">

<p>The ComputeMux Compiler is an OpenCL C and SPIR-V compiler that consumes the
source code or IL provided by an application and compiles it into an executable
that can be loaded by the ComputeMux Runtime.</p>
<p>The module aims to provide a boundary beyond which no LLVM type definitions pass
in order to keep logical concerns separate.</p>
<div class="section" id="structure">
<a class="header-link" href="#structure"><h2 id="structure">Structure</h2><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">compiler</code> module is structured as a set of virtual interfaces and a loader
library, with a number of concrete implementations for different ComputeMux
targets. The virtual interfaces reside in <code class="docutils literal notranslate">include/compiler/*.h</code>, the library
entry point resides in <code class="docutils literal notranslate">library/include/library.h</code> and
<code class="docutils literal notranslate">library/source/library.cpp</code>, the dynamic loader library resides in
<code class="docutils literal notranslate">loader/include/loader.h</code> and <code class="docutils literal notranslate">loader/source/loader.cpp</code>, and the various
implementations reside in <code class="docutils literal notranslate">targets/*/</code>.</p>
<div class="section" id="dynamic-vs-static-loading">
<a class="header-link" href="#dynamic-vs-static-loading"><h3 id="dynamic-vs-static-loading">Dynamic vs Static loading</h3><span class="material-icons">link</span></a>
<p>The compiler is designed to be used either directly as a static library,
or indirectly through a loader library.</p>
<div class="section" id="static-library">
<a class="header-link" href="#static-library"><h4 id="static-library">Static Library</h4><span class="material-icons">link</span></a>
<p>The simplest way to use the compiler library is to link with the
<code class="docutils literal notranslate">compiler-static</code> target. Through this target, the compiler is accessed through
the <code class="docutils literal notranslate">compiler/library.h</code> header. This target is unavailable if CMake is
configured with <span class="target" id="index-0-variable:CA_RUNTIME_COMPILER_ENABLED"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_RUNTIME_COMPILER_ENABLED</code> set to <code class="docutils literal notranslate">OFF</code></p>
</div>
<div class="section" id="dynamic-loader">
<a class="header-link" href="#dynamic-loader"><h4 id="dynamic-loader">Dynamic Loader</h4><span class="material-icons">link</span></a>
<p>A more flexible option to use the compiler is to instead link wtih the
<code class="docutils literal notranslate">compiler-loader</code> target. Through this target, the compiler is accessed through
the <code class="docutils literal notranslate">compiler/loader.h</code> header. This header is similar to <code class="docutils literal notranslate">compiler/library.h</code>,
however each method additionally requires a <code class="docutils literal notranslate">compiler::Library</code> object,
created using <code class="docutils literal notranslate">compiler::loadLibrary</code>.</p>
<p>The purpose of the loader is to provide a compiler interface that will be
available when compiling the oneAPI Construction Kit regardless of the value of
<span class="target" id="index-1-variable:CA_RUNTIME_COMPILER_ENABLED"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_RUNTIME_COMPILER_ENABLED</code>, and regardless of whether the
compiler is loaded at runtime or linked statically.</p>
<p>If <span class="target" id="index-2-variable:CA_RUNTIME_COMPILER_ENABLED"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_RUNTIME_COMPILER_ENABLED</code> is set to <code class="docutils literal notranslate">ON</code> then the
compiler loader can operate in two different ways:</p>
<ul>
<li><p>If <span class="target" id="index-0-variable:CA_COMPILER_ENABLE_DYNAMIC_LOADER"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_COMPILER_ENABLE_DYNAMIC_LOADER</code> is set to <code class="docutils literal notranslate">ON</code>, then
<code class="docutils literal notranslate">compiler::loadLibrary</code> will look for <code class="docutils literal notranslate">compiler.dll</code> (Windows) or
<code class="docutils literal notranslate">libcompiler.so</code> (Linux) in the default library search paths, depending on the
platform.</p>
<p>If the environment variable <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate">CA_COMPILER_PATH</code> is set, then its value
will be used as the library name instead. Additionally, if
<span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate">CA_COMPILER_PATH</code> is set to an empty string, then
<code class="docutils literal notranslate">compiler::loadLibrary</code> will skip loading entirely and will operate as if no
compiler is available.</p>
<p>In this configuration, targets which depend on <code class="docutils literal notranslate">compiler-loader</code> should also
add the <code class="docutils literal notranslate">compiler</code> target (the compiler shared library) as a dependency using
<code class="docutils literal notranslate">add_dependencies</code>. See <code class="docutils literal notranslate">source/cl/CMakeLists.txt</code> for an example.</p>
</li>
<li><p>If <span class="target" id="index-0-variable:CA_COMPILER_ENABLE_DYMAMIC_LOADER"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_COMPILER_ENABLE_DYMAMIC_LOADER</code> is set to <code class="docutils literal notranslate">OFF</code>, then
<code class="docutils literal notranslate">compiler-loader</code> will transitively depend on <code class="docutils literal notranslate">compiler-static</code>, and
<code class="docutils literal notranslate">compiler::loadLibrary</code> will instead immediately return an instance of
<code class="docutils literal notranslate">compiler::Library</code> that references the static functions directly.</p></li>
</ul>
<p>If <span class="target" id="index-3-variable:CA_RUNTIME_COMPILER_ENABLED"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_RUNTIME_COMPILER_ENABLED</code> is set to <code class="docutils literal notranslate">OFF</code>, then
<code class="docutils literal notranslate">compiler::loadLibrary</code> will always return <code class="docutils literal notranslate">nullptr</code>, and therefore the compiler
will be disabled.</p>
<p>By default, the oneAPI Construction Kit is configured with
<span class="target" id="index-4-variable:CA_RUNTIME_COMPILER_ENABLED"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_RUNTIME_COMPILER_ENABLED</code> set to <code class="docutils literal notranslate">ON</code> and
<span class="target" id="index-1-variable:CA_COMPILER_ENABLE_DYNAMIC_LOADER"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_COMPILER_ENABLE_DYNAMIC_LOADER</code> set to <code class="docutils literal notranslate">OFF</code>.</p>
</div>
<div class="section" id="selecting-a-compiler-implementation">
<a class="header-link" href="#selecting-a-compiler-implementation"><h4 id="selecting-a-compiler-implementation">Selecting a compiler implementation</h4><span class="material-icons">link</span></a>
<p>A compiler implementation is represented by a singleton instance of a
<code class="docutils literal notranslate">compiler::Info</code> object. A list of all available compilers can be obtained by
calling <code class="docutils literal notranslate">compiler::compilers()</code>, whilst <code class="docutils literal notranslate">compiler::getCompilerForDevice</code> can
be used to select the relevant compiler for a particular <code class="docutils literal notranslate">mux_device_info_t</code>.</p>
</div>
</div>
<div class="section" id="info">
<a class="header-link" href="#info"><h3 id="info">Info</h3><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">compiler::Info</code> struct (<code class="docutils literal notranslate">include/compiler/info.h</code>)  describes a
particular compiler implementation that can be used to compile programs for a
particular <code class="docutils literal notranslate">mux_device_info_t</code>. <code class="docutils literal notranslate">Info</code> contains information about the
compiler capabilities and metadata, and additionally acts as an interface for
creating a <code class="docutils literal notranslate">compiler::Target</code> object.</p>
</div>
<div class="section" id="context">
<a class="header-link" href="#context"><h3 id="context">Context</h3><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">compiler::Context</code> interface (<code class="docutils literal notranslate">include/compiler/context.h</code>) serves as
an opaque wrapper over the LLVM context object. This object can also contain
other shared state used by compiler modules, and contains a mutex that is locked
when interacting with a specific instance of LLVM.</p>
</div>
<div class="section" id="target">
<a class="header-link" href="#target"><h3 id="target">Target</h3><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">compiler::Target</code> interface (<code class="docutils literal notranslate">include/compiler/target.h</code>) represents a
particular target device to generate machine code for. This object is also
responsible for creating instances of <code class="docutils literal notranslate">compiler::Module</code> (described below).</p>
</div>
<div class="section" id="module">
<a class="header-link" href="#module"><h3 id="module">Module</h3><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">compiler::Module</code> interface (<code class="docutils literal notranslate">include/compiler/module.h</code>) is responsible
for driving the compilation process from source code all the way to machine
code. It acts as a container for LLVM IR by wrapping the LLVM Module object, and
executes the required passes.</p>
<div class="section" id="compile-opencl-c">
<a class="header-link" href="#compile-opencl-c"><h4 id="compile-opencl-c">Compile OpenCL C</h4><span class="material-icons">link</span></a>
<p>The clang frontend is instantiated in the <code class="docutils literal notranslate">compiler::Module::compileOpenCLC</code>
member function, this is where:</p>
<ul class="simple">
<li><p>The OpenCL C language options are specified to the frontend</p></li>
<li><p>User specified macro definitions and include directories are set</p></li>
<li><p><code class="docutils literal notranslate">mux</code> device force-include headers (if present) are set</p></li>
<li><p>A diagnostic handler is provided to report compilation errors</p></li>
</ul>
<p>This compilation stage also introduces the pre-compiled builtins header
providing the OpenCL C builtin function declarations to the frontend.
Compilation occurs when the <code class="docutils literal notranslate">clang::EmitLLVMOnlyAction</code> is invoked, then
ownership of the resulting <code class="docutils literal notranslate">llvm::Module</code> is transferred to
<code class="docutils literal notranslate">compiler::Module</code> to be used in the next stage. Any errors occurring
during compilation are returned in the error log specified during the
construction of <code class="docutils literal notranslate">compiler::Module</code>, where they can be queried by the
application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In OpenCL, the <code class="docutils literal notranslate">compiler::Module::compileOpenCLC</code> member function directly
maps to <code class="docutils literal notranslate">clCompileProgram</code> but is also invoked by <code class="docutils literal notranslate">clBuildProgram</code>.</p>
</div>
</div>
<div class="section" id="compile-spir-v">
<a class="header-link" href="#compile-spir-v"><h4 id="compile-spir-v">Compile SPIR-V</h4><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">compiler::Module::compileSPIRV</code> member function implements the SPIR-V
frontend. First, the SPIR-V module is handed to <code class="docutils literal notranslate">spirv_ll::Context::translate</code>
to turn it into a <code class="docutils literal notranslate">llvm::Module</code>, then some additional fixup passes are applied.</p>
</div>
<div class="section" id="link">
<a class="header-link" href="#link"><h4 id="link">Link</h4><span class="material-icons">link</span></a>
<p>During <code class="docutils literal notranslate">compiler::Module::link</code>, the LLVM module is first cloned before the list
of all provided <code class="docutils literal notranslate">compile::Module</code>‘s are linked into the current module. As
before, during <code class="docutils literal notranslate">compiler::Module::compileOpenCLC</code>, a diagnostics handler is
specified. If linking was successful, the previous module is destroyed and the
linked modules ownership is moved to <code class="docutils literal notranslate">compiler::Module</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In OpenCL, the <code class="docutils literal notranslate">compiler::Module::link</code> member function directory maps to
<code class="docutils literal notranslate">clLinkProgram</code> but is also invoked by <code class="docutils literal notranslate">clBuildProgram</code>.</p>
</div>
</div>
<div class="section" id="finalize">
<a class="header-link" href="#finalize"><h4 id="finalize">Finalize</h4><span class="material-icons">link</span></a>
<p>Finalization is the final compilation stage which executes any remaining LLVM
passes and getting it ready to be passed to the backend implementation. This is
where the majority of the LLVM passes are run, once again on a clone of the
<code class="docutils literal notranslate">llvm::Module</code> owned by the <code class="docutils literal notranslate">compiler::Module</code> object. Once the
<code class="docutils literal notranslate">llvm::PassManager</code> has run all of the desired passes, the LLVM module is
ready to be turned into machine code, either through
<code class="docutils literal notranslate">compiler::Module::createBinary</code>, or possibly deferred at runtime through the
<code class="docutils literal notranslate">compiler::Kernel</code> object.</p>
</div>
</div>
<div class="section" id="kernel">
<a class="header-link" href="#kernel"><h3 id="kernel">Kernel</h3><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">compiler::Kernel</code> interface (<code class="docutils literal notranslate">include/compiler/kernel.h</code>) represents a
single function entry point in a finalized <code class="docutils literal notranslate">compiler::Module</code>. It’s main purpose
is to provide an opportunity for the backend to perform optimizations and code
generation as late as possible. Most of the work is driven by the
<code class="docutils literal notranslate">compiler::Module::createSpecializedKernel</code> method that creates a Mux runtime
kernel potentially optimized for a set of execution options that will be passed
to it during <code class="docutils literal notranslate">muxCommandNDRange</code>.</p>
</div>
</div>
<div class="section" id="opencl-c-passes">
<a class="header-link" href="#opencl-c-passes"><h2 id="opencl-c-passes">OpenCL C Passes</h2><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">compiler</code> module provides a number of LLVM passes, which are specific to
processing the LLVM IR produced by clang after compiling OpenCL C source code.
The IR is processed into a form that the backend can consume. The passes are
described immediately below in the order they are executed by the LLVM pass
manager.</p>
<div class="section" id="fast-math">
<a class="header-link" href="#fast-math"><h3 id="fast-math">Fast Math</h3><span class="material-icons">link</span></a>
<p>The OpenCL standard defines an optional <code class="docutils literal notranslate">-cl-fast-relaxed-math</code> flag that can be
set when building programs, allowing optimizations on floating point arithmetic
that could violate the IEEE-754 standard. When this flag is used we run the LLVM
module level pass <code class="docutils literal notranslate">FastMathPass</code> to perform these optimizations straight after
frontend parsing from clang.</p>
<p>First the pass looks for any <code class="docutils literal notranslate">llvm::FPMathOperator</code> instructions and for those
found sets the <code class="docutils literal notranslate">llvm::FastMathFlags</code> attribute to enable all of:</p>
<ul class="simple">
<li><p>Unsafe algebra - Operation can be algebraically transformed.</p></li>
<li><p>No <code class="docutils literal notranslate">NaN</code>s - Arguments and results can be treated as non-NaN.</p></li>
<li><p>No <code class="docutils literal notranslate">Inf</code>s - Arguments and results can be treated as non-Infinity.</p></li>
<li><p>No Signed Zeros - Sign of zero can be treated as insignificant.</p></li>
<li><p>Allow Reciprocal - Reciprocal can be used instead of division.</p></li>
</ul>
<p>As well as the above <code class="docutils literal notranslate">compiler::FastMathPass</code> replaces maths and geometric
builtin functions with fast variants. Any math builtin functions which have a
native equivalent are replaced with the native function, specified as having an
implementation defined maximum error. For example <code class="docutils literal notranslate">exp2(float4)</code> is replaced
with <code class="docutils literal notranslate">native_exp2(float4)</code>.</p>
<p>Geometric builtins <code class="docutils literal notranslate">distance</code>, <code class="docutils literal notranslate">length</code>, and <code class="docutils literal notranslate">normalize</code> are all defined in
OpenCL as having fast variants <code class="docutils literal notranslate">fast_distance</code>, <code class="docutils literal notranslate">fast_length</code>, and
<code class="docutils literal notranslate">fast_normalize</code> which use reduced precision maths. If any of these functions
are present we also replace them with the relaxed alternative.</p>
<p>These builtin replacements are done by searching the LLVM module for call
instructions which invoke the mangled name of a builtin function we want to
replace. If the fast version of the builtin isn’t already in the module, i.e. it
wasn’t called explicitly somewhere else, then we also need to add a function
declaration for the mangled name of the fast builtin. Finally a new call
instruction is created invoking the fast function declaration and the old call
it replaces is deleted.</p>
</div>
<div class="section" id="bit-shift-fixup">
<a class="header-link" href="#bit-shift-fixup"><h3 id="bit-shift-fixup">Bit Shift Fixup</h3><span class="material-icons">link</span></a>
<p>LLVM IR does not define the results of oversized shift amounts, however some
high-level languages such as OpenCL C do. As a result shift instructions need
to be updated to perform a ‘modulo N’ by the shift amount prior to the shift
operation itself, where N is the bit width of the value to shift.</p>
<p><code class="docutils literal notranslate">BitShiftFixupPass</code> implements this as a LLVM function pass iterating over all
the function instructions looking for shifts. For each shift found the pass uses
the first operand to work out ‘N’ for the modulo based on the bit width of the
operand type. If the shift amount from the second operand is less than N
however, then we can skip the shift without inserting a modulo operation since
the shift is not oversized. We can also skip shift instructions that already
have the modulo applied, which can happen if the module was created by clang.
Otherwise the pass creates a modulo by generating a ‘logical and’ instruction
with operands <code class="docutils literal notranslate">N-1</code> and the original shift amount, this masked value is then
used to replace the second operand of the shift.</p>
</div>
<div class="section" id="software-division">
<a class="header-link" href="#software-division"><h3 id="software-division">Software Division</h3><span class="material-icons">link</span></a>
<p>The compiler pass <code class="docutils literal notranslate">SoftwareDivisionPass</code> is a function level pass designed to
prevent undefined behaviour in division operations. To do this the pass adds
runtime checks using <code class="docutils literal notranslate">llvm::CmpInst</code> instructions for two specific cases, divide
by zero and <code class="docutils literal notranslate">INT_MIN / -1</code>. Due to the specification of undefined behaviour if
one of these cases is detected we are free to update the behaviour of the divide
operation. In both cases we set the divisor operand of the divide instruction to
be <code class="docutils literal notranslate">+1</code> using a <code class="docutils literal notranslate">llvm::SelectInst</code> with the original operand based on the result
of our checks.</p>
<p>Since IEEE-754 defines these error cases for floating point types our runtime
checks only need to be applied to integer divides. This is ensured in the pass
by checking if the instruction opcode is one of <code class="docutils literal notranslate">SDiv</code>, <code class="docutils literal notranslate">SRem</code>, <code class="docutils literal notranslate">UDiv</code>, <code class="docutils literal notranslate">URem</code>.
Whereas floating point divide instructions will have opcode <code class="docutils literal notranslate">FDiv</code> or <code class="docutils literal notranslate">FRem</code>.</p>
</div>
<div class="section" id="image-argument-substitution">
<a class="header-link" href="#image-argument-substitution"><h3 id="image-argument-substitution">Image Argument Substitution</h3><span class="material-icons">link</span></a>
<p>OpenCL image calls with opaque types are replaced to use those coming from the
image library.</p>
</div>
<div class="section" id="memtoreg">
<a class="header-link" href="#memtoreg"><h3 id="memtoreg">MemToReg</h3><span class="material-icons">link</span></a>
<p>A manual implementation of LLVM’s MemToReg pass, which promotes allocas
which have only loads and stores as uses to register references. This is needed
because after LLVM 5.0 <code class="docutils literal notranslate">llvm:MemToReg</code> has regressed and is not removing all
the allocas it should be.</p>
</div>
<div class="section" id="builtin-simplification">
<a class="header-link" href="#builtin-simplification"><h3 id="builtin-simplification">Builtin Simplification</h3><span class="material-icons">link</span></a>
<p><code class="docutils literal notranslate">BuiltinSimplificationPass</code> is a module level pass for simplifying builtin
function calls. The pass performs two kinds of optimization on builtins:</p>
<ul class="simple">
<li><p>Converts builtins to more efficient variants where possible (for example, a
call to the math function <code class="docutils literal notranslate">pow(x, y)</code>, where <code class="docutils literal notranslate">y</code> is a constant that is
representable by an integer, will be converted to <code class="docutils literal notranslate">pown(x, y)</code>).</p></li>
<li><p>Replace builtins whose arguments are all constant (for example, a call to the
math function <code class="docutils literal notranslate">cos(x)</code>, where <code class="docutils literal notranslate">x</code> is a constant, will be replaced by a new
constant value that is the calculation of the cosine of <code class="docutils literal notranslate">x</code>).</p></li>
</ul>
</div>
<div class="section" id="printf-replacement">
<a class="header-link" href="#printf-replacement"><h3 id="printf-replacement"><code class="docutils literal notranslate">printf</code> Replacement.</h3><span class="material-icons">link</span></a>
<p>Of the myriad of architectures that have ComputeMux back ends, most do not have
access to an implementation of <code class="docutils literal notranslate">printf</code> whereby they can route a call to
<code class="docutils literal notranslate">printf</code> within a kernel to <code class="docutils literal notranslate">stdout</code> of the process running on the host CPU
processor.</p>
<p>To enable our ComputeMux back ends to call <code class="docutils literal notranslate">printf</code>, we provide an optimized
software implementation. An additional kernel argument buffer is implicitly
added to any kernel that uses <code class="docutils literal notranslate">printf</code>, and our implementation of <code class="docutils literal notranslate">printf</code>
that is run on the ComputeMux backend will write the results of the <code class="docutils literal notranslate">printf</code>
into this buffer instead. Then, when the kernel has completed its execution, the
data that was written to this buffer is streamed out on the host CPU processor
via <code class="docutils literal notranslate">stdout</code>.</p>
</div>
<div class="section" id="combine-fpext-fptrunc">
<a class="header-link" href="#combine-fpext-fptrunc"><h3 id="combine-fpext-fptrunc">Combine <code class="docutils literal notranslate">fpext</code> <code class="docutils literal notranslate">fptrunc</code></h3><span class="material-icons">link</span></a>
<p><code class="docutils literal notranslate">CombineFPExtFPTruncPass</code> is a function level pass, rather than a module pass,
for removing <code class="docutils literal notranslate">FPExt</code> and <code class="docutils literal notranslate">FPTrunc</code> instructions that cancel each out. This is
used after the <code class="docutils literal notranslate">printf</code> replacement pass because var-args <code class="docutils literal notranslate">printf</code> arguments
will be expanded to double by clang even if the device doesn’t support doubles.
So if the device doesn’t support doubles, the <code class="docutils literal notranslate">printf</code> pass will <code class="docutils literal notranslate">fptrunc</code> the
parameters back to float. <code class="docutils literal notranslate">CombineFPExtFPTruncPass</code> will find and remove the
matching <code class="docutils literal notranslate">fpext</code> (added by clang) and <code class="docutils literal notranslate">fptrunc</code> (added by the <code class="docutils literal notranslate">printf</code> pass) to
get rid of the doubles.</p>
<p>The pass is implemented by iterating over all the instructions looking for any
<code class="docutils literal notranslate">llvm::FPExtInst</code> instructions. If one is found then we check its uses, if the
<code class="docutils literal notranslate">fpext</code> is unused, remove it. Otherwise if the instruction only has one use and
it’s a <code class="docutils literal notranslate">llvm::FPTruncInst</code> then we can replace all uses of the <code class="docutils literal notranslate">fptrunc</code> with
the first operand of <code class="docutils literal notranslate">fpext</code> and delete both the <code class="docutils literal notranslate">fptrunc</code> and <code class="docutils literal notranslate">fpext</code>.</p>
</div>
<div class="section" id="set-convergent-attr">
<a class="header-link" href="#set-convergent-attr"><h3 id="set-convergent-attr">Set <code class="docutils literal notranslate">convergent</code> Attr</h3><span class="material-icons">link</span></a>
<p>In clang the <code class="docutils literal notranslate">convergent</code> attribute can be set on a function to indicate to
the optimizer that the function relies on cross work item semantics.  For
OpenCL we need this attribute to be set on the barrier function, for example,
since it’s used to control the scheduling of threads.  Recent versions of clang
will proactively set such functions in OpenCL-C kernels as <code class="docutils literal notranslate">convergent</code>, but
we also set the attribute implicitly in the builtins header out of an abundance
of caution.</p>
<p>This pass iterates over all the functions in the module, including declarations
requiring the pass to be a module pass instead of a function pass. If the
function inspected may be convergent, identified by the compiler’s
<code class="docutils literal notranslate">BuiltinInfo</code> analysis, then we assign the <code class="docutils literal notranslate">llvm::Attribute::Convergent</code>
attribute to it. When the pass encounters a convergent function, all functions
calling that function are transitively marked convergent.</p>
</div>
</div>
</div>
</div>
</div></body>
<!-- Mirrored from 127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/compiler by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 22 Sep 2025 18:52:46 GMT -->
</html>
                    <a id="bottom"></a>
                </div>

                <!-- Separator -->
                <div class="separator"></div>

                <!-- Rate -->
                <div id="rate" class="rate collapsed">
                    <div>
                        Rate this Guide
                    </div>
                    <form action="https://formspree.io/f/xzbypbvl" method="post">
                        <input type="hidden" name="subject" value="Guide Feedback" />
                        <input type="hidden" name="product" value="oneAPI" />
                        <input type="hidden" name="variant" value="Construction Kit" />
                        <input type="hidden" name="guide" value="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/compiler" />

                        <div class="up" title="Thumb up this guide">
                           <i class="material-icons">thumb_up</i>
                       </div>
                        <div class="down" title="Thumb down this guide">
                            <i class="material-icons">thumb_down</i>
                        </div>
                        <div>
                            <input type="text" name="message"
                                   required="required"
                                   minlength="3"
                                   maxlength="1000"
                                   placeholder="How can we improve this guide? (press enter to send)" />
                        </div>
                    </form>
                </div>

                <!-- Separator -->
                <div class="separator"></div>

                <!-- Navigator -->
                <div id="navigator">
                    <div>
                        <a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/changes#bottom"
                            >
                            <div>
                                <i class="material-icons">navigate_before</i>
                            </div>
                            <div>
                                <h1>Change Log</h1>
                            </div>
                        </a>
                    </div>
                    <div>
                        <a href="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/modules/mux/cmake"
                            >
                            <div>
                                <h1>CMake</h1>
                            </div>
                            <div>
                                <i class="material-icons">navigate_next</i>
                            </div>
                        </a>
                    </div>
                </div>
            </article>

            <!-- Separator -->
            <div class="separator"></div>

            <!-- Footer Target -->
            <div id="footer-target"></div>
        </div>

        <!-- File Jump List -->
        <div id="jump-list-container" class="sticky styled-scroller">
            <div class="nav-padding">
                <div class="jump-list-container">
                    <h1 class="file-container-title">
                        <span class="material-icons">assignment</span>Jump to Section
                    </h1>
                    <ol class="in-page-jump-list">
                        <li class="heading-1"><a href="#computemux-compiler">ComputeMux Compiler</a></li>
                        <li class="heading-2"><a href="#structure">Structure</a></li>
                        <li class="heading-2"><a href="#opencl-c-passes">OpenCL C Passes</a></li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Handle layout resizing here to avoid jumping -->
<script nonce="a6d6cd9fad07e9926cde9a9076e4cc02">
    const resizerCookie = getCookie('CDPRESIZER');
    if (resizerCookie) {
        const cookieValue = JSON.parse(resizerCookie);

        for (let [key, value] of Object.entries(cookieValue)) {
            if (value === null || value === undefined) {
                continue;
            }

            key = atob(key);
            $(':root')[0].style.setProperty('--' + key, value + 'px');
        }
    }
</script>

</main>

<!-- Product Selector-->
<div id="productSelectorDialog" class="popupDialog">
    <div class="side-by-side-panel panel">
        <div id="products">
            <div>
                <h1>Select a Product</h1>
            </div>
            <ul>
                <li>
                    <a class="productSelection oneapi" data-product="oneapi">
                        oneAPI
                    </a>
                </li>
            </ul>
        </div>
        <div id="product-selection">
            <div id="no-product">
                Please select a product
            </div>
            <div id="product">
                <div id="product-oneapi" class="product-view">
                    <h1>

                        oneAPI
                    </h1>
                    <p>oneAPI is a cross-industry, open, standards-based unified programming model that delivers a common developer experience across accelerator architecture - for faster application performance, more productivity, and greater innovation.</p>
                    <ul id="variants">
                        <li>
                            <a href="http://127.0.0.1/products/oneapi/construction-kit/">
                                <div>
                                    Construction Kit
                                </div>
                                <div>
                                    <i class="material-icons">arrow_right</i>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="http://127.0.0.1/products/oneapi/amd/">
                                <div>
                                    for AMD GPU
                                </div>
                                <div>
                                    <i class="material-icons">arrow_right</i>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="http://127.0.0.1/products/oneapi/nvidia/">
                                <div>
                                    for NVIDIA® GPUs
                                </div>
                                <div>
                                    <i class="material-icons">arrow_right</i>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Color Scheme Selector-->
<div id="colorSchemeDialog" class="popupDialog">
    <div>
        <div class="selectDarkMode">
            <div>
                <img src="http://127.0.0.1/assets/img/darkmode.png" alt="Dark Mode" />
            </div>
            <div>
                <i class="material-icons">brightness_2</i>
                <h1>Dark Mode</h1>
                <p>Light text on a dark background.</p>
            </div>
        </div>
        <div class="selectLightMode">
            <div>
                <img src="http://127.0.0.1/assets/img/lightmode.png" alt="Light Mode" />
            </div>
            <div>
                <i class="material-icons">lightbulb_outline</i>
                <h1>Light Mode</h1>
                <p>Dark text on a light background.</p>
            </div>
        </div>
    </div>
</div>

<!-- Site Selector -->
<div id="siteSelectorDialog" class="popupDialog">
    <div class="panel" id="profile-panel">
        <header>
            <div>
                <i class="material-icons">public</i>
            </div>
            <div>
                <h1>Also,</h1>
                <h2>part of our network</h2>
            </div>
        </header>
        <ul>
            <li>
                <a href="https://www.codeplay.com/" target="_blank" rel="nofollow noopener noreferrer">
                    <h1>Codeplay.com</h1>
                    <p>Find out about Codeplay, the latest company news and blog posts.</p>
                </a>
            </li>
            <li>
                <a href="https://www.sycl.tech/" target="_blank" rel="nofollow noopener noreferrer">
                    <h1>SYCL.tech</h1>
                    <p>Find out about the latest SYCL news, videos and projects.</p>
                </a>
            </li>
            <li class="selected">
                <a>
                    <img src="http://127.0.0.1/assets/img/you-are-here.png" alt="You Are Here Logo" />
                    <h1>Codeplay Developer</h1>
                    <p>Get the latest documentation and release packages for ComputeCpp and ComputeSuite</p>
                </a>
            </li>
            <li>
                <a href="https://github.com/codeplaysoftware" target="_blank" rel="nofollow noopener noreferrer">
                    <h1>Codeplay Open Source</h1>
                    <p>Browse our open source projects and frameworks on GitHub.</p>
                </a>
            </li>
        </ul>
    </div>
</div>

<!-- Footer section -->
<footer class="section-padding">
    <div class="content-wrapper">
        <div>
            <h1>&copy; Codeplay Software Ltd</h1>
            <div id="copyright"></div>
        </div>
        <div>
            <ul>
                <li><a href="https://codeplay.com/" target="_blank" rel="noopener">
                    Visit codeplay.com</a></li>
                <li><a href="https://codeplay.com/company/privacy/" target="_blank" rel="noopener">
                    View Our Privacy Policy</a></li>
                <li><a href="http://127.0.0.1/cookies/">
                    Read Our Cookie Policy</a></li>
            </ul>
        </div>
    </div>
</footer>

</body>
</html>