<!DOCTYPE html>
<html lang="en-US" class="">

<!-- Mirrored from 127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/test/unitcl.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 22 Sep 2025 18:49:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <!-- Basics -->
    <title>UnitCL - Guides - oneAPI Construction Kit - Products - Codeplay Developer</title>
    <meta name="description" content="Read the 'UnitCL' for oneAPI Construction Kit 4.0.0 developer guide." />
    <meta name="keywords" content="guides, tutorials, guide, oneapi, construction, kit, risc-v, arm" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Open Graph -->
    <meta name="title" property="og:title" content="UnitCL - Guides - oneAPI Construction Kit - Products - Codeplay Developer" />
    <meta name="type" property="og:type" content="website" />
    <meta name="image" property="og:image" content="../../../../../../../../assets/img/og-header.png" />
    <meta name="url" property="og:url" content="../../../../../../../../index.html" />
    <meta name="description" property="og:description" content="Read the 'UnitCL' for oneAPI Construction Kit 4.0.0 developer guide." />

    <!-- Fonts -->
    <link href="../../../../../../../../assets/css/material.css"
          rel="stylesheet preload prefetch"
          as="style" />

    <!-- Fav icon -->
    <link rel="icon" type="image/png" href="../../../../../../../../favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="../../../../../../../../favicon.svg" />
    <link rel="shortcut icon" href="../../../../../../../../favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../../../../../apple-touch-icon.html" />

    <link type="text/css"
          href="../../../../../../../../assets/css/responsive.css"
          rel="stylesheet"/>

    <script src="https://cdn.usefathom.com/script.js" data-site="XBWVDDFP" defer></script>

    <!-- Stylesheets -->
    <link type="text/css"
          href="../../../../../../../../assets/css/jquery.cookiepolicyprompt.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="../../../../../../../../assets/css/jquery.popupdialog.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="../../../../../../../../assets/css/dialogs.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="../../../../../../../../assets/css/Pages/IndexPage.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="../../../../../../../../assets/css/Pages/Guides/GuidePageLayout.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="../../../../../../../../assets/css/Pages/Guides/GuidePageFormatting.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="../../../../../../../../assets/css/Pages/Guides/GuidePage.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="../../../../../../../../assets/css/Pages/Products/OneApi/ConstructionKit/OneApiConstructionKitShared.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="../../../../../../../../assets/css/Pages/Products/OneApi/ConstructionKit/Guide/OneApiConstructionKitGuidePage.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>
    <link type="text/css"
          href="../../../../../../../../assets/css/Pages/Products/OneApi/ConstructionKit/Guide/OneApiConstructionKitGuidePage.style.css"
          rel="stylesheet preload prefetch"
          as="style"/>

    <!-- Scripts -->
    <script src="../../../../../../../../assets/js/jquery-3.6.3.min.js"></script>
    <script src="../../../../../../../../assets/js/jquery.copyright.js"></script>
    <script src="../../../../../../../../assets/js/jquery.cookiepolicyprompt.js"></script>
    <script src="../../../../../../../../assets/js/jquery.popupdialog.js"></script>
    <script src="../../../../../../../../assets/js/Pages/IndexPage.script.js"></script>
    <script src="../../../../../../../../assets/js/highlight.min.js"></script>
    <script src="../../../../../../../../assets/js/Pages/Guides/jquery.headingsinfocus.js"></script>
    <script src="../../../../../../../../assets/js/Pages/Guides/togglebutton.js"></script>
    <script src="../../../../../../../../assets/js/Pages/Guides/jquery.resizable.js"></script>
    <script src="../../../../../../../../assets/js/Pages/Guides/GuidePage.script.js"></script>

    <script>
        document.querySelectorAll('link').forEach((el) => {this.onload=null;this.rel='stylesheet';});
    </script>
</head>
<body data-deprecated="">

<!-- Header -->
<header>
    <nav class="main">
        <div>
            <a aria-label="Navigation Bar Logo" href="../../../../../../../../index.html">
                <div id="codeplay-logo"></div>
            </a>
        </div>
        <div>
            <a title="Click to change production selection">
                <div>
                    <h2>Product</h2>
                    <h1>oneAPI Construction Kit</h1>
                </div>
            </a>
        </div>
        <div>
            <ul>
                <li >
                    <a href="../../../../../home.html" >
                        <div>

                            <span class="icon material-icons">home</span>

                            <div>Home</div>
                        </div>
                    </a>
                </li>
                <li  class="selected" >
                    <a href="../../../../../guides/index.html" >
                        <div>

                            <span class="icon material-icons">menu_book</span>

                            <div>Guides</div>
                        </div>
                    </a>
                </li>
                <li >
                    <a href="https://github.com/codeplaysoftware/oneapi-construction-kit" target="_blank">
                        <div>

                            <span class="icon material-icons">local_library</span>

                            <div>Repository</div>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <div>
            <ul>
                <li>
                    <a href="../../../../../../../../support/index.html" title="Get Support">
                        <span class="material-icons">help_outline</span>
                    </a>
                </li>
                <li>
                    <a id="burger"
                       title="Show Navigation Menu">
                        <span class="material-icons">menu</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- The burger menu, designed for mobile -->
    <div id="burger-menu">
        <ul>
            <li>
                <h1>oneAPI Menu</h1>
                <ul>
                    <li >
                        <a href="../../../../../home.html"
                           >Home</a>
                    </li>
                    <li  class="selected" >
                        <a href="../../../../../guides/index.html"
                           >Guides</a>
                    </li>
                    <li >
                        <a href="https://github.com/codeplaysoftware/oneapi-construction-kit"
                           target="_blank">Repository</a>
                    </li>
                </ul>
            </li>
            <li>
                <h1>Main Menu</h1>
                <ul>
                    <li>
                        <a href="../../../../../../../../index.html">Home</a>
                    </li>
                    <li>
                        <h1>Products</h1>
                        <ul>
                            <li>
                                <a href="../../../../../../../computecpp/ce/index.html">ComputeCpp CE</a>
                            </li>
                            <li>
                                <a href="../../../../../../../computecpp/pe/index.html">ComputeCpp PE</a>
                            </li>
                            <li>
                                <a href="../../../../../../../computesuitercar/ce/index.html">ComputeSuite for R-Car CE</a>
                            </li>
                            <li>
                                <a href="../../../../../../../computesuitercar/pe/index.html">ComputeSuite for R-Car PE</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="../../../../../../../../cookies.html">Cookie Policy</a>
                    </li>
                    <li>
                        <a href="https://codeplay.com/support/contact">Contact Us</a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</header>

<!-- Main element -->
<main>

    <!-- File Container -->
<div class="layout-file guide" id="source-cl-test-unitcl">
    <!-- Side Menu -->
    <div class="sticky file-menu-container styled-scroller">
       <div class="nav-padding">
           <!-- Title & Version Selector -->
           <div class="header">
               <h1 class="file-container-title">
                   <span class="material-icons">menu_book</span>Guides
               </h1>
               <div>
                   <!-- Version Selector -->
                   <div class="version-selector ">
                       <div><span class="material-icons">history</span>4.0.0</div>
                       <ul>
                           <li><a href="../../../index.html">4.0.0</a></li>
                           <li><a href="../../../../../3.0.0/guides/index.html">3.0.0</a></li>
                           <li><a href="../../../../../2.0.0/guides/index.html">2.0.0</a></li>
                       </ul>
                       <ul>
                           <li><a href="../../../index.html">4.0.0</a></li>
                           <li><a href="../../../../../3.0.0/guides/index.html">3.0.0</a></li>
                           <li><a href="../../../../../2.0.0/guides/index.html">2.0.0</a></li>
                       </ul>
                       <ul>
                           <li><a href="../../../index.html">4.0.0</a></li>
                           <li><a href="../../../../../3.0.0/guides/index.html">3.0.0</a></li>
                           <li><a href="../../../../../2.0.0/guides/index.html">2.0.0</a></li>
                       </ul>
                   </div>
               </div>
           </div>
           <!-- Menu -->
           <ol class="file-menu">
               <li class=""><a href="../../../index-2.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Welcome to oneAPI Construction Kit’s documentation!</a><ol></ol></li>               <li class=""><a href="../../../overview.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>oneAPI Construction Kit Overview</a><ol><li class=""><a href="../../../overview/preface.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Preface</a><ol></ol></li><li class=""><a href="../../../overview/introduction.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Introduction</a><ol><li class=""><a href="../../../overview/introduction/architecture.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>oneAPI Construction Kit Architecture</a><ol></ol></li><li class=""><a href="../../../overview/introduction/compiler-view.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Compiler View</a><ol></ol></li></ol></li><li class=""><a href="../../../overview/hardware.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Mapping ComputeMux to Hardware</a><ol><li class=""><a href="../../../overview/hardware/memory-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Memory Requirements</a><ol></ol></li><li class=""><a href="../../../overview/hardware/atomic-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Atomic Requirements</a><ol></ol></li><li class=""><a href="../../../overview/hardware/floating-point-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Floating-Point Requirements</a><ol></ol></li><li class=""><a href="../../../overview/hardware/synchronization-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Synchronization Requirements</a><ol></ol></li></ol></li><li class=""><a href="../../../overview/runtime.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Runtime Information</a><ol><li class=""><a href="../../../overview/runtime/computemux-runtime.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Runtime</a><ol></ol></li><li class=""><a href="../../../overview/runtime/driver-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Driver Requirements</a><ol></ol></li><li class=""><a href="../../../overview/runtime/supported-toolchains.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Supported Toolchains</a><ol></ol></li></ol></li><li class=""><a href="../../../overview/compiler.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Compiler Information</a><ol><li class=""><a href="../../../overview/compiler/computemux-compiler.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Compiler</a><ol></ol></li><li class=""><a href="../../../overview/compiler/ir.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Intermediate Representation</a><ol></ol></li><li class=""><a href="../../../overview/compiler/supported-llvm-versions.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Supported LLVM Versions</a><ol></ol></li><li class=""><a href="../../../overview/compiler/non-requirements.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Compiler Non-Requirements</a><ol></ol></li></ol></li><li class=""><a href="../../../overview/example-scenarios.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Example Hardware Feature Scenarios</a><ol><li class=""><a href="../../../overview/example-scenarios/mapping-custom-instructions-to-builtin-functions.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Mapping Custom Instructions To Builtin Functions</a><ol></ol></li><li class=""><a href="../../../overview/example-scenarios/mapping-custom-ip-blocks-to-builtin-kernels.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Mapping Custom IP Blocks To Builtin Kernels</a><ol></ol></li><li class=""><a href="../../../overview/example-scenarios/how-to-support-large-scratchpad-memories.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>How To Support Large Scratchpad Memories</a><ol></ol></li><li class=""><a href="../../../overview/example-scenarios/mapping-algorithms-to-vector-hardware.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Mapping Algorithms To Vector Hardware</a><ol></ol></li><li class=""><a href="../../../overview/example-scenarios/refsi-in-kernel-dma.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>RefSi In-Kernel DMA for RISC-V</a><ol></ol></li></ol></li><li class=""><a href="../../../overview/toolkit.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>oneAPI Construction Kit</a><ol></ol></li><li class=""><a href="../../../overview/new-target-quick-start.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Creating a New ComputeMux Target: Quick Start</a><ol></ol></li><li class=""><a href="../../../overview/tutorials.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Tutorials</a><ol><li class=""><a href="../../../overview/tutorials/creating-a-new-hal.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Creating a New HAL</a><ol><li class=""><a href="../../../overview/tutorials/creating-new-hal/initial-setup.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Initial Setup</a><ol></ol></li><li class=""><a href="../../../overview/tutorials/creating-new-hal/kernel-compilation.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Kernel Compilation</a><ol></ol></li><li class=""><a href="../../../overview/tutorials/creating-new-hal/runing-clik-tests.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Running clik Tests</a><ol></ol></li><li class=""><a href="../../../overview/tutorials/creating-new-hal/skeleton-hal-overview.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Overview of the Skeleton HAL Code</a><ol></ol></li><li class=""><a href="../../../overview/tutorials/creating-new-hal/implementing-hal-operations.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Implementing HAL Operations</a><ol></ol></li></ol></li><li class=""><a href="../../../overview/tutorials/creating-a-new-mux-target.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Creating a New ComputeMux Target</a><ol><li class=""><a href="../../../overview/tutorials/creating-a-new-mux-target/running-new-target-script.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Running the create_target.py Script</a><ol></ol></li><li class=""><a href="../../../overview/tutorials/creating-a-new-mux-target/building-and-running-tests.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Building and Running Tests</a><ol></ol></li><li class=""><a href="../../../overview/tutorials/creating-a-new-mux-target/adapting-target-pass-pipeline.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Adapting the Pass Pipeline for the Target</a><ol></ol></li><li class=""><a href="../../../overview/tutorials/creating-a-new-mux-target/extending-it-further.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Extending it Further</a><ol></ol></li></ol></li></ol></li><li class=""><a href="../../../overview/reference-silicon.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Codeplay Reference Silicon</a><ol><li class=""><a href="../../../overview/reference-silicon/overview.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Codeplay Reference Silicon Overview</a><ol></ol></li><li class=""><a href="../../../overview/reference-silicon/command-processor.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Command Processor Reference</a><ol></ol></li><li class=""><a href="../../../overview/reference-silicon/dma-controller.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>DMA Controller Reference</a><ol></ol></li><li class=""><a href="../../../overview/reference-silicon/dma-programming-guide.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>DMA Programming Guide</a><ol></ol></li><li class=""><a href="../../../overview/reference-silicon/driver-interface.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>RefSi Driver Interface</a><ol></ol></li><li class=""><a href="../../../overview/reference-silicon/mapping-opencl-to-refsi.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>How The Platform Maps to SYCL and OpenCL</a><ol></ol></li></ol></li></ol></li>               <li class=""><a href="../../../getting-started.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Getting Started</a><ol></ol></li>               <li class=""><a href="../../../specifications.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Specifications</a><ol><li class=""><a href="../../../specifications/versioning.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Versioning Scheme</a><ol></ol></li><li class=""><a href="../../../specifications/mux-runtime-spec.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Runtime Specification</a><ol></ol></li><li class=""><a href="../../../specifications/mux-compiler-spec.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ComputeMux Compiler Specification</a><ol></ol></li></ol></li>               <li class=""><a href="../../../developer-guide.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Developer Guide</a><ol></ol></li>               <li class=""><a href="../../../tutorials.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Tutorials</a><ol><li class=""><a href="../../../tutorials/adding-a-custom-builtins-extension.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Adding A Custom Builtins Extension</a><ol></ol></li><li class=""><a href="../../../tutorials/custom-lowering-work-item-builtins.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Custom Lowering Work-Item Builtins</a><ol></ol></li><li class=""><a href="../../../tutorials/adding-target-specific-metadata.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Adding Target-Specific Metadata</a><ol></ol></li></ol></li>               <li class=""><a href="../../../design.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Design</a><ol></ol></li>               <li class="selected"><a href="../../cl.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>OpenCL</a><ol><li class=""><a href="../cmake.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>OpenCL CMake</a><ol></ol></li><li class=""><a href="../computemux_mapping.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>How OpenCL Concepts Are Mapped Onto ComputeMux</a><ol></ol></li><li class=""><a href="../extension.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>OpenCL Extensions</a><ol><li class=""><a href="../extension/cl_codeplay_kernel_debug.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Kernel Debug - cl_codeplay_kernel_debug</a><ol></ol></li><li class=""><a href="../extension/cl_codeplay_extra_build_options.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Extra Build Options - cl_codeplay_extra_build_options</a><ol></ol></li><li class=""><a href="../extension/cl_codeplay_kernel_exec_info.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Kernel Exec Info - cl_codeplay_kernel_exec_info</a><ol></ol></li><li class=""><a href="../extension/cl_codeplay_performance_counters.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Performance Counters - cl_codeplay_performance_counters</a><ol></ol></li><li class=""><a href="../extension/cl_codeplay_soft_math.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Soft Math - cl_codeplay_soft_math</a><ol></ol></li><li class=""><a href="../extension/cl_codeplay_wfv.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Whole Function Vectorization - cl_codeplay_wfv</a><ol></ol></li><li class=""><a href="../extension/cl_intel_unified_shared_memory.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>USM - cl_intel_unified_shared_memory</a><ol></ol></li><li class=""><a href="../extension/cl_intel_required_subgroup_size.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Required subgroup sizes for kernels  - cl_intel_required_subgroup_size</a><ol></ol></li></ol></li><li class=""><a href="../external-extensions.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>OpenCL External Extensions</a><ol></ol></li><li class=""><a href="../icd-loader.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>OpenCL ICD Loader</a><ol></ol></li><li class=""><a href="../intercept.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>OpenCL Intercept Layer</a><ol></ol></li><li class=""><a href="../tools.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Tools</a><ol></ol></li><li class="selected"><a href="../test.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Tests</a><ol><li class="selected focused"><a href="unitcl.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>UnitCL</a><ol></ol></li></ol></li></ol></li>               <li class=""><a href="../../vk.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Vulkan</a><ol></ol></li>               <li class=""><a href="../../../modules.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Modules</a><ol><li class=""><a href="../../../modules/builtins.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Builtins</a><ol><li class=""><a href="../../../modules/builtins/abacus.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Abacus</a><ol></ol></li><li class=""><a href="../../../modules/builtins/libimg.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Image Library</a><ol></ol></li></ol></li><li class=""><a href="../../../modules/mux.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>ComputeMux</a><ol><li class=""><a href="../../../modules/mux/changes.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Change Log</a><ol></ol></li><li class=""><a href="../../../modules/mux/compiler.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Compiler</a><ol></ol></li><li class=""><a href="../../../modules/mux/cmake.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>CMake</a><ol></ol></li><li class=""><a href="../../../modules/mux/bumping-the-spec.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Bumping the Specification Version</a><ol></ol></li></ol></li><li class=""><a href="../../../modules/host.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Host CPU</a><ol><li class=""><a href="../../../modules/mux/targets/host/extension/cl_codeplay_host_builtins.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>cl_codeplay_host_builtins</a><ol></ol></li><li class=""><a href="../../../modules/mux/targets/host/extension/cl_codeplay_set_threads.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>cl_codeplay_set_threads</a><ol></ol></li><li class=""><a href="../../../modules/mux/targets/host/lit.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Host lit test suite</a><ol></ol></li><li class=""><a href="../../../modules/mux/targets/host/debug.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Host Debug Features</a><ol></ol></li></ol></li><li class=""><a href="../../../modules/riscv.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>RISC-V</a><ol></ol></li><li class=""><a href="../../../modules/compiler.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Compiler</a><ol><li class=""><a href="../../../modules/compiler/overview.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Overview</a><ol></ol></li><li class=""><a href="../../../modules/compiler/utils.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Compiler Utilities</a><ol></ol></li><li class=""><a href="../../../modules/compiler/tools.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Tools</a><ol><li class=""><a href="../../../modules/compiler/tools/muxc.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>muxc</a><ol></ol></li></ol></li></ol></li><li class=""><a href="../../../modules/loader.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>ELF loader</a><ol></ol></li><li class=""><a href="../../../modules/vecz.html"><div class="icon"><span class="icon material-icons">subdirectory_arrow_right</span></div>Vecz</a><ol><li class=""><a href="../../../modules/vecz/vecz.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Vecz Documentation</a><ol></ol></li></ol></li><li class=""><a href="../../../modules/spirv-ll.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>spirv-ll</a><ol></ol></li><li class=""><a href="../../../modules/debug.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Debug Module</a><ol></ol></li><li class=""><a href="../../../modules/cargo.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Cargo Module</a><ol></ol></li><li class=""><a href="../../../modules/metadata.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Metadata API</a><ol></ol></li></ol></li>               <li class=""><a href="../../../cmake.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>CMake Development</a><ol></ol></li>               <li class=""><a href="../../../scripts.html"><div class="icon"><span class="icon material-icons">arrow_forward</span></div>Scripts</a><ol></ol></li>           </ol>
       </div>
    </div>
    <!-- Core Content -->
    <div>
        <!-- File Content -->
        <div id="content-container" class="nav-padding">
            <article class="file-content-container">
                <header>
                    <!-- Deprecated Notice -->

                    <div class="title">
                        <a class="header-link" href="#unitcl">
                            <h1>UnitCL</h1>
                        </a>
                        <div>
                            <a href="#rate" title="Rate this guide">
                                <i class="material-icons">thumb_up</i>
                            </a>

                            <a target="_blank" href="https://github.com/codeplaysoftware/oneapi-construction-kit/blob/main/doc/source/cl/test/unitcl.rst" rel="noopener" title="Contribute to this guide">
                                <i class="material-icons">edit</i>
                            </a>

                            <a href="../../vk-2.html" title="Goto the next guide">
                                <i class="material-icons">arrow_forward_ios</i>
                            </a>
                        </div>
                    </div>

                </header>

                <div class="formatted-text">
                    <a id="top"></a>
                    <html><body><div class="document">
<div>
<div class="section" id="unitcl">

<p>UnitCL is an OpenCL API unit test suite, built on the Google Test unit test
framework. It tests all aspects of an OpenCL implementation, including API call
correctness, kernel compilation, kernel execution, and extension support.</p>
<p>UnitCL focuses on both positive and negative testing. It tests that the
implementation behaves as specified when given valid inputs, and that it fails
correctly and gracefully when given invalid inputs. Conformant OpenCL
implementations are permitted to fail (even catastrophically) with invalid
inputs. However, UnitCL has been designed with the pragmatic assumption that it
is much better for an OpenCL implementation to fail gracefully and not to
segfault.</p>
<p>UnitCL is capable of testing both OpenCL 1.2 and OpenCL 3.0 specifications.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>OpenCL 3.0 support is not yet complete.</p>
</div>
<div class="section" id="target-specific-unitcl-tests">
<a class="header-link" href="#target-specific-unitcl-tests"><h2 id="target-specific-unitcl-tests">Target-Specific UnitCL Tests</h2><span class="material-icons">link</span></a>
<p>If you have additional tests that you would like to be run as part of UnitCL,
then these can be added using the following steps. This is done to avoid
conflicts and to allow you to keep project specific tests separate.</p>
<p>There is just one cmake variable that needs to be set:</p>
<dl class="cmake variable">
<dt class="sig sig-object cmake" id="variable:${MUX_TARGET}_EXTERNAL_UNITCL_SRC">
<span class="sig-name descname">${MUX_TARGET}_EXTERNAL_UNITCL_SRC</span></dt>
<dd><p>The list of source files that you want to add into UnitCL.</p>
</dd></dl>
<p>Where <code class="docutils literal notranslate">${MUX_TARGET}</code> is the same registered name in
<code class="docutils literal notranslate">${MUX_TARGET_LIBRARIES}</code> for the particular project. UnitCL will search all
the names and append all source files related to them into UnitCL.</p>
<p>An example of a project specific test would be one related to the testing of a
vendor extension. If your test is generic OpenCL, it is preferable to add this
to the main UnitCL test suite so that it can benefit all targets.</p>
<pre><code class="language-cmake"># The list of source files that you want to add into UnitCL.
set(${MUX_TARGET}_EXTERNAL_UNITCL_SRC
  dir/to/your_test_source.cpp
  dir/to/additional_test_source.cpp)
</code>
</pre>
<p>If your test requires additional include directories, then these can be
appended to <code class="docutils literal notranslate">${${MUX_TARGET}_EXTERNAL_UNITCL_INC}</code>. These directories are
added to the include search path when UnitCL is built. If, for example, your
test is for a vendor extension that adds an API entry point, then the external
include directories will contain the header for the entry point.</p>
<p>If your test uses a kernel in a separate file (i.e., the test’s kernel is not
an in-line string), then you can add the file by appending to
<code class="docutils literal notranslate">${${MUX_TARGET}_UNITCL_KERNEL_FILES}</code> similarly to how you would do it for
source files. If you are using a kernel in a separate file, then you are
<a class="reference internal" href="#writing-kernel-execution-tests">Writing Kernel Execution Tests</a>.</p>
<p>If your tests should only be run on your device, then add a device name check
to either the relevant <code class="docutils literal notranslate">SetUp()</code> functions or at the top of the individual
tests.  The <code class="docutils literal notranslate">isDevice_&lt;MUX_TARGET&gt;()</code> functions from <code class="docutils literal notranslate">Device.h</code> make this
easy. They are automatically generated from device names registered in
<code class="docutils literal notranslate">{MUX_TARGET_LIBRARIES}</code>. A test that can only run on <code class="docutils literal notranslate">host</code> might start
like this:</p>
<pre><code class="language-cpp">#include "Device.h"
// ...
if (!UCL::isDevice_host(UCL::getDevices()[0])) {
  GTEST_SKIP();
}
</code>
</pre>
</div>
<div class="section" id="executing-unitcl">
<a class="header-link" href="#executing-unitcl"><h2 id="executing-unitcl">Executing UnitCL</h2><span class="material-icons">link</span></a>
<p>To run UnitCL to test against your application, you can simply run the following
and it will run all of the test cases!</p>
<pre><code class="language-shell">$ &lt;build&gt;/bin/UnitCL
</code>
</pre>
<p>The above will use the system configured OpenCL, generally this will run via the
ICD. If you would like to link with a particular OpenCL then for example on
Windows you can copy the <code class="docutils literal notranslate">libOpenCL.dll</code> into the local folder, or on Linux
you can use a command similar to:</p>
<pre><code class="language-shell">$ LD_LIBRARY_PATH=&lt;search/path/for/lib&gt; &lt;build&gt;/bin/UnitCL
</code>
</pre>
<p>Kernel execution tests currently use a relative directory and as such require
UnitCL to be called from the root of the build directory to find the kernel
folder (located within <code class="docutils literal notranslate">bin</code>). If you’d prefer you can specify
<code class="docutils literal notranslate">--unitcl_kernel_directory</code> and point this to wherever the kernel directory
is.</p>
<pre><code class="language-shell">$ &lt;build&gt;/bin/UnitCL --unitcl_kernel_directory=&lt;path/to/kernels&gt;
</code>
</pre>
<p>UnitCL will skip test cases that are not applicable to the particular OpenCL
device. For example, if the device does not support the <code class="docutils literal notranslate">cl_khr_fp16</code>
extension, then test cases that use half precision floating point are skipped.
When the device does not have a compiler (which may be the case for some
devices that only support the embedded profile), then a large number of test
cases will be skipped. Many test cases depend on kernels from source, and these
require a compiler.</p>
</div>
<div class="section" id="unitcl-options">
<a class="header-link" href="#unitcl-options"><h2 id="unitcl-options">UnitCL Options</h2><span class="material-icons">link</span></a>
<p>As <code class="docutils literal notranslate">UnitCL</code> is built upon Google Test, any of the existing options that
Google Test allows are valid. Below is the output from <code class="docutils literal notranslate">UnitCL -h</code> showing
the flags that are supported by Google Test;</p>
<p>This program contains tests written using Google Test. You can use the
following command line flags to control its behavior:</p>
<div class="section" id="test-selection">
<a class="header-link" href="#test-selection"><h3 id="test-selection">Test Selection</h3><span class="material-icons">link</span></a>
<ul class="simple">
<li><p><code class="docutils literal notranslate">--gtest_list_tests</code> - List the names of all tests instead of running them,
The name of <code class="docutils literal notranslate">TEST(Foo, Bar)</code> is <code class="docutils literal notranslate">Foo.Bar</code>.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_filter=POSITIVE_PATTERNS[-NEGATIVE_PATTERNS]</code> - Run only the tests
whose name matches one of the positive patterns but none of the negative
patterns; <code class="docutils literal notranslate">?</code> matches any single character; <code class="docutils literal notranslate">*</code> matches any substring;
and <code class="docutils literal notranslate">:</code> separates two patterns.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_also_run_disabled_tests</code> - Run all disabled tests too.</p></li>
</ul>
</div>
<div class="section" id="test-execution">
<a class="header-link" href="#test-execution"><h3 id="test-execution">Test Execution</h3><span class="material-icons">link</span></a>
<ul class="simple">
<li><p><code class="docutils literal notranslate">--gtest_repeat=[COUNT]</code> - Run the tests repeatedly; use a negative count
to repeat forever.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_shuffle</code> - Randomize tests’ orders on every iteration.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_random_seed=[NUMBER]</code> - Random number seed to use for shuffling
test orders (between 1 and 99999, or 0 to use a seed based on the current
time).</p></li>
</ul>
</div>
<div class="section" id="test-output">
<a class="header-link" href="#test-output"><h3 id="test-output">Test Output</h3><span class="material-icons">link</span></a>
<ul class="simple">
<li><p><code class="docutils literal notranslate">--gtest_color=(yes|no|auto)</code> - Enable/disable colored output. The default
is auto.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_print_time=0</code> - Don’t print the elapsed time of each test.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_output=xml[:DIRECTORY_PATH/|:FILE_PATH]</code> - Generate an XML report
in the given directory or with the given file name. <code class="docutils literal notranslate">FILE_PATH</code> defaults to
<code class="docutils literal notranslate">test_details.xml</code>.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_stream_result_to=HOST:PORT</code> - Stream test results to the given
server.</p></li>
</ul>
</div>
<div class="section" id="assertion-behavior">
<a class="header-link" href="#assertion-behavior"><h3 id="assertion-behavior">Assertion Behavior</h3><span class="material-icons">link</span></a>
<ul class="simple">
<li><p><code class="docutils literal notranslate">--gtest_death_test_style=(fast|threadsafe)</code> - Set the default death test
style.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_break_on_failure</code> - Turn assertion failures into debugger
break-points.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_throw_on_failure</code> - Turn assertion failures into C++ exceptions.</p></li>
<li><p><code class="docutils literal notranslate">--gtest_catch_exceptions=0</code> - Do not report exceptions as test failures.
Instead, allow them to crash the program or throw a pop-up (on Windows).</p></li>
</ul>
<p>Except for <code class="docutils literal notranslate">--gtest_list_tests</code>, you can alternatively set the corresponding
environment variable of a flag (all letters in upper-case). For example, to
disable colored text output, you can either specify <code class="docutils literal notranslate">--gtest_color=no</code> or set
the <code class="docutils literal notranslate">GTEST_COLOR</code> environment variable to no.</p>
<p>For more information, please read the <a class="reference external" href="https://github.com/google/googletest">Google Test documentation</a>. If you find
a bug in Google Test (not one in your own code or tests), please <a class="reference external" href="mailto_googletestframework%40googlegroups.html">report it</a>.</p>
</div>
<div class="section" id="unitcl-specific-options">
<a class="header-link" href="#unitcl-specific-options"><h3 id="unitcl-specific-options">UnitCL-Specific Options</h3><span class="material-icons">link</span></a>
<p>UnitCL also parses some extra command line options above and beyond what Google
Test provides:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate">--gtest_filter=-*UNSPECIFIED*</code> - Disable all tests for behavior not
mandated by the specification.</p></li>
<li><p><code class="docutils literal notranslate">--unitcl_platform=&lt;vendor&gt;</code> - Provide an OpenCL platform vendor to use for
testing.</p></li>
<li><p><code class="docutils literal notranslate">--unitcl_device=&lt;device_name&gt;</code> - Provide an OpenCL device name to use for
testing.</p></li>
<li><p><code class="docutils literal notranslate">--unitcl_test_include=&lt;path&gt;</code> - Provide the path to the supplied
<code class="docutils literal notranslate">test_include</code> directory. Current setting: <code class="docutils literal notranslate">test/UnitCL/test_include</code></p></li>
<li><p><code class="docutils literal notranslate">--unitcl_kernel_directory=&lt;device_name&gt;</code> - Provide the path to the
supplied kernels directory</p></li>
<li><p><code class="docutils literal notranslate">--unitcl_build_options=&lt;option_string&gt;</code> - Provide compilation options to
pass to <code class="docutils literal notranslate">clBuildProgram</code> when compiling kernels in the ‘kernels’ directory.</p></li>
<li><p><code class="docutils literal notranslate">--unitcl_seed=&lt;unsigned&gt;</code> - Provide an unsigned integer to seed the random
number generator with.</p></li>
<li><p><code class="docutils literal notranslate">--unitcl_math={quick, wimpy, full}</code> - Run math builtins tests over an
increasing data size, defaults to wimpy.</p></li>
<li><p><code class="docutils literal notranslate">--vecz-check</code> - Mark tests as failed if the vectorizer did not vectorize
them.</p></li>
<li><p><code class="docutils literal notranslate">--opencl_info</code> - Print OpenCL platform and devices info</p></li>
</ul>
</div>
</div>
<div class="section" id="default-test-variations">
<a class="header-link" href="#default-test-variations"><h2 id="default-test-variations">Default Test Variations</h2><span class="material-icons">link</span></a>
<p>When running UnitCL via the oneAPI Construction Kit <code class="docutils literal notranslate">check-ock-UnitCL*</code> CMake
targets, various compiler configurations will be run. For example, there is a
configuration that sets <code class="docutils literal notranslate">-cl-opt-disable</code> (<code class="docutils literal notranslate">check-ock-UnitCL-opt-disable</code>),
one that sets <code class="docutils literal notranslate">-cl-wfv=always</code> (<code class="docutils literal notranslate">check-ock-UnitCL-vecz</code>), etc. Some of
these variations may have no effect on some customer targets. E.g., if a
ComputeMux target does not use Vecz, then the <code class="docutils literal notranslate">check-ock-UnitCL*</code> CMake
targets testing Vecz will effectively duplicate the <code class="docutils literal notranslate">check-ock-UnitCL*</code> CMake
targets that don’t test Vecz.</p>
<p>To reduce the amount of duplicated testing, many of these <code class="docutils literal notranslate">check-ock-UnitCL*</code>
CMake targets run UnitCL with a filter of common compiler-related words.  This
way, only tests that match one of these keywords are run more than once.  The
filter used is a good match for the default UnitCL tests, but it is only
convention. It is possible that additional tests are added by a customer team
for a specific ComputeMux target that <em>do</em> test the compiler but <em>do not</em> match
any of the filter words.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the intent of a UnitCL test is to test the compiler and the various
compiler configurations, then the test name <strong>must</strong> include one of the
compiler-related keywords. Otherwise, the <code class="docutils literal notranslate">check-ock-UnitCL*</code> CMake targets
will not run the test.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The filter of compiler-related keywords is stored in the CMake variable
<code class="docutils literal notranslate">CA_CL_COMPILER_TEST_FILTER</code>. It currently selects tests that have any of
<code class="docutils literal notranslate">Compile</code>, <code class="docutils literal notranslate">Link</code>, <code class="docutils literal notranslate">Build</code>, <code class="docutils literal notranslate">Execution</code>, or <code class="docutils literal notranslate">print</code> in the name.</p>
</div>
</div>
<div class="section" id="kernel-execution-tests">
<a class="header-link" href="#kernel-execution-tests"><h2 id="kernel-execution-tests">Kernel Execution Tests</h2><span class="material-icons">link</span></a>
<p>Regular UnitCL tests are primarily intended to verify the behavior of OpenCL
API entry points. These tests check various parameter combinations to API
calls, check that correct error codes are returned, etc. Kernel execution
tests, on the other hand, test that kernels are compiled and executed
correctly. Execution tests test compiler corner cases, the precision of math
functions, and so on. The key difference between the two types of tests is that
the kernels used by execution tests are always stored in separate files.
Regular UnitCL tests sometimes don’t even need kernels, when they do the
kernels are usually defined in-line, and separate kernel files are only rarely
used.</p>
<p>There is some obvious overlap between the two types of tests, since regular
tests sometimes need to execute kernels, and execution tests rely on API entry
points functioning correctly.</p>
<p>By default, writing a single execution test produces six different tests in
UnitCL, each one exercising a different code path. The six test types are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate">Execution</code> - The driver compiles the OpenCL-C kernel to binary and
executes it.</p></li>
<li><p><code class="docutils literal notranslate">OfflineExecution</code> - The driver executes a binary kernel that has
previously been compiled using <code class="docutils literal notranslate">clc</code>.</p></li>
<li><p><code class="docutils literal notranslate">SpirvExecution</code> - The driver compiles a SPIR-V version of the kernel to
binary and executes it.</p></li>
<li><p><code class="docutils literal notranslate">OfflineSpirvExecution</code> - The driver executes a binary kernel that has
previously been compiled from SPIR-V using <code class="docutils literal notranslate">clc</code>.</p></li>
</ul>
<p>The test type is used as the prefix for the test name in UnitCL. Writing a test
<code class="docutils literal notranslate">foo</code> will produce tests named <code class="docutils literal notranslate">Execution.foo</code>, <code class="docutils literal notranslate">OfflineExecution.foo</code>,
etc. As far as GoogleTest is concerned, there is nothing special about these
generated tests, and they can be filtered just like regular tests:</p>
<pre><code class="language-shell"># Run all six variations of the foo test
./UnitCL --gtest_filter=*foo

# Run all SPIR-V execution tests
./UnitCL --gtest_filter=SpirvExecution*
</code>
</pre>
<p>The compilation-to-binary step of the three types of offline tests happens
during UnitCL build time using <code class="docutils literal notranslate">clc</code>. Since <code class="docutils literal notranslate">clc</code> is based on the same code
as the OpenCL driver itself, even just building UnitCL partially tests the
OpenCL implementation.</p>
<p>The following sections provide more details on the process of writing execution
tests and how UnitCL is built. See <a class="reference internal" href="#generating-spir-v">Generating SPIR-V</a> for creating SPIR-V
versions of the kernel.</p>
<div class="section" id="writing-kernel-execution-tests">
<a class="header-link" href="#writing-kernel-execution-tests"><h3 id="writing-kernel-execution-tests">Writing Kernel Execution Tests</h3><span class="material-icons">link</span></a>
<p>To write a Kernel Execution Test, you will need to write two things: a C++ part
that will include the test in the test suite and define the execution
environment of the kernel (inputs, expected outputs, work size etc.), as well
as the actual OpenCL-C kernel that you want to test.</p>
<p>Files related to Kernel Execution Tests may show references to the name KTS.
These are remnants from when it was an entirely separate test suite known as the
Kernel Test Suite (KTS).</p>
<p>The C++ test and the OpenCL-C kernel are linked through their names only, the
name of the file and of the kernel are inferred from the name of the test in the
following way:</p>
<ul class="simple">
<li><p>Format for test names: <code class="docutils literal notranslate">TestSet_X_KernelName</code>, where X is a two digit
number and where <code class="docutils literal notranslate">_X_</code> is the last underscore two digit combination that
occurs in the test name.</p></li>
<li><p>Example name: <code class="docutils literal notranslate">Task_01_01_Copy</code>.</p></li>
<li><p>Kernel file to load: <code class="docutils literal notranslate">task_1.01_copy.cl</code>.</p></li>
<li><p>Kernel name: <code class="docutils literal notranslate">copy</code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Kernel files must be located in the <code class="docutils literal notranslate">UnitCL/kernels</code> directory. The kernel
files are copied into the build directory at build time by the <a class="reference internal" href="#copy-kernels-target">copy-kernels
target</a> , so you must add your kernel to <code class="docutils literal notranslate">kernels/CMakeLists.txt</code>. You can
also use the <code class="docutils literal notranslate">--unitcl_kernel_directory</code> argument to specify in which
directory to look for the kernel files.</p>
</div>
<p>To write the C++ test and set up the execution environment of your kernel, KTS
provides convenient utility functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate">RunGeneric1D</code>: Will launch the kernel, it takes the global size as a first
parameter and the local size as an optional second parameter. The default
local size is 0. KTS provide <code class="docutils literal notranslate">kts::N</code> and <code class="docutils literal notranslate">kts::localN</code> as defaults
global and local size that can be used in tests.</p></li>
<li><p><code class="docutils literal notranslate">RunGenericND</code>: Will launch the kernel, it takes the number of dimensions
as a first parameter, a pointer to the global dimensions as the second and a
pointer to the local dimensions as an third parameter.</p></li>
<li><p><code class="docutils literal notranslate">AddInputBuffer</code>: Will add an input buffer to the kernel, its first
parameter is the size of the buffer, and the second is a <code class="docutils literal notranslate">kts::Reference1D</code>
function that will be used to generate the content of the buffer.</p></li>
<li><p><code class="docutils literal notranslate">AddOutputBuffer</code>: Will add an output buffer to the kernel, its first
parameter is the size of the buffer, and the second is a <code class="docutils literal notranslate">kts::Reference1D</code>
function that should generate the expected output of the kernel, it will be
used to check the actual output of the kernel.</p></li>
<li><p><code class="docutils literal notranslate">AddInOutBuffer</code>: Will add an input and output buffer to the kernel. The
first parameter is the size of the buffers. The second is a
<code class="docutils literal notranslate">kts::Reference1D</code> that will generate the content of the input buffer
whilst the third is a <code class="docutils literal notranslate">kts::Reference1D</code> that will be used to check the
actual output of the kernel.</p></li>
<li><p><code class="docutils literal notranslate">AddPrimitive</code>: Will add a by value parameter to the kernel, and it takes
only one parameter, the actual value to pass to the kernel.</p></li>
<li><p><code class="docutils literal notranslate">AddMacro</code>: Will add a macro in the kernel, the first parameter of this
function is the name of the macro, and the second is an unsigned value
representing the value of the macro.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The order in which the functions to set the parameters are called must match
the order of the matching kernel arguments.</p>
</div>
<p>To generate the input and output of a kernel, KTS requires the user to provide
functions matching the type of <code class="docutils literal notranslate">kts::Reference1D</code>, this is a templated type
that matches a function taking an <code class="docutils literal notranslate">int</code> and returning a value of the template
parameter type. The <code class="docutils literal notranslate">int</code> value passed to the function is the global id for
which we want to generate a value.</p>
<p><code class="docutils literal notranslate">kts::BuildVecXReference1D</code> (with X a vector size in 2,3,4) is provided to
allow extrapolation of a <code class="docutils literal notranslate">kts::Reference1D</code> for a vector type from a
<code class="docutils literal notranslate">kts::Reference1D</code> for the matching scalar type.</p>
<p>A set of common <code class="docutils literal notranslate">kts::Reference1D</code> functions is also provided for use with
kernel execution tests, available in <code class="docutils literal notranslate">source/kts_reference_functions.h</code>.</p>
<p>The <code class="docutils literal notranslate">TEST_P(Execution, TEST_NAME)</code> macro is used to create execution tests.
The <code class="docutils literal notranslate">Execution</code> fixture is parameterized over the source type of the OpenCL
program to test:</p>
<dl class="cpp enum">
<dt class="sig sig-object cpp" id="_CPPv4N3kts3ucl10SourceTypeE">
<span id="_CPPv3N3kts3ucl10SourceTypeE"></span><span id="_CPPv2N3kts3ucl10SourceTypeE"></span><span class="k">enum</span><span class="w"> </span><span class="sig-prename descclassname"><span class="n">kts</span><span class="p">::</span><span class="n">ucl</span><span class="p">::</span></span><span class="sig-name descname"><span class="n">SourceType</span></span><br></dt>
<dd><dl class="cpp enumerator">
<dt class="sig sig-object cpp" id="_CPPv4N3kts3ucl10SourceType8OPENCL_CE">
<span id="_CPPv3N3kts3ucl10SourceType8OPENCL_CE"></span><span id="_CPPv2N3kts3ucl10SourceType8OPENCL_CE"></span><span class="k">enumerator</span><span class="w"> </span><span class="sig-name descname"><span class="n">OPENCL_C</span></span><br></dt>
<dd><p>Loads an OpenCL C (<code class="docutils literal notranslate">.cl</code>) source  file from disk.</p>
</dd></dl>
<dl class="cpp enumerator">
<dt class="sig sig-object cpp" id="_CPPv4N3kts3ucl10SourceType5SPIRVE">
<span id="_CPPv3N3kts3ucl10SourceType5SPIRVE"></span><span id="_CPPv2N3kts3ucl10SourceType5SPIRVE"></span><span class="k">enumerator</span><span class="w"> </span><span class="sig-name descname"><span class="n">SPIRV</span></span><br></dt>
<dd><p>Loads a SPIR-V (<code class="docutils literal notranslate">.spv32</code>/<code class="docutils literal notranslate">.spv64</code>) file from disk.</p>
</dd></dl>
<dl class="cpp enumerator">
<dt class="sig sig-object cpp" id="_CPPv4N3kts3ucl10SourceType7OFFLINEE">
<span id="_CPPv3N3kts3ucl10SourceType7OFFLINEE"></span><span id="_CPPv2N3kts3ucl10SourceType7OFFLINEE"></span><span class="k">enumerator</span><span class="w"> </span><span class="sig-name descname"><span class="n">OFFLINE</span></span><br></dt>
<dd><p>Loads a  pre-compiled <code class="docutils literal notranslate">.cl</code> binary (<code class="docutils literal notranslate">.bin</code>) file from disk.</p>
</dd></dl>
<dl class="cpp enumerator">
<dt class="sig sig-object cpp" id="_CPPv4N3kts3ucl10SourceType12OFFLINESPIRVE">
<span id="_CPPv3N3kts3ucl10SourceType12OFFLINESPIRVE"></span><span id="_CPPv2N3kts3ucl10SourceType12OFFLINESPIRVE"></span><span class="k">enumerator</span><span class="w"> </span><span class="sig-name descname"><span class="n">OFFLINESPIRV</span></span><br></dt>
<dd><p>Loads a pre-compiled <code class="docutils literal notranslate">.spv32</code>/<code class="docutils literal notranslate">.spv64</code> (<code class="docutils literal notranslate">.bin</code>) file from disk.</p>
</dd></dl>
</dd></dl>
<p>Sometimes it may be necessary to skip one or more source types. For example, a
test might trigger a known OFFLINE bug so the OFFLINE versions need to be
skipped, or a test might only be valid when compiled just-in-time from OpenCL
C. In these cases the <code class="xref cpp cpp-func docutils literal notranslate">kts::ucl::isSourceTypeIn()</code> utility function
should be used to determine if a test should be skipped:</p>
<pre><code class="language-cpp">TEST_P(Execution, Test) {
  if (!isSourceTypeIn({OPENCL_C, SPIRV}) {
    GTEST_SKIP();
  }
}
</code>
</pre>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>In addition to the <code class="docutils literal notranslate">Execution</code> fixture the following more specific fixtures
are also available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate">ExecutionOpenCLC</code> - for <a class="reference internal" href="#_CPPv4N3kts3ucl10SourceType8OPENCL_CE"><code class="xref cpp cpp-enumerator docutils literal notranslate">kts::ucl::SourceType::OPENCL_C</code></a>
and <a class="reference internal" href="#_CPPv4N3kts3ucl10SourceType7OFFLINEE"><code class="xref cpp cpp-enumerator docutils literal notranslate">kts::ucl::SourceType::OFFLINE</code></a></p></li>
<li><p><code class="docutils literal notranslate">ExecutionSPIRV</code> - for <a class="reference internal" href="#_CPPv4N3kts3ucl10SourceType5SPIRVE"><code class="xref cpp cpp-enumerator docutils literal notranslate">kts::ucl::SourceType::SPIRV</code></a> and
<a class="reference internal" href="#_CPPv4N3kts3ucl10SourceType12OFFLINESPIRVE"><code class="xref cpp cpp-enumerator docutils literal notranslate">kts::ucl::SourceType::OFFLINESPIRV</code></a> source types</p></li>
</ul>
</div>
</div>
<div class="section" id="writing-parameterized-tests">
<a class="header-link" href="#writing-parameterized-tests"><h3 id="writing-parameterized-tests">Writing Parameterized Tests</h3><span class="material-icons">link</span></a>
<p>When a parameterized test is needed, the <code class="docutils literal notranslate">ExecutionWithParam</code> fixture template
should be used in conjunction with the <code class="docutils literal notranslate">UCL_EXECUTION_TEST_SUITE_P</code> macro to
instantiate the test suite.</p>
<pre><code class="language-cpp">using MyExecutionWithInt = ExecutionWithParam&lt;int&gt;;

// Instantiates the test suite over all source types and 3 int values.
UCL_EXECUTION_TEST_SUITE_P(MyExecutionWithInt,
                           testing::ValuesIn(kts::ucl::getSourceTypes()),
                           testing::Values(23, 42, 88));

TEST_P(MyExecutionWithInt, Test) {
  // Use getParam() instead of GetParam() to access the int parameter, this
  // is provided by the ExecutionWithParam fixture to make accessing the non
  // source type parameter easier.
  int i = getParam();
  // ...
}
</code>
</pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using macros in your test, you will need to add a <code class="docutils literal notranslate">// CLC OPTIONS:
-D&lt;...&gt;</code> comment to the OpenCL C kernel so that the macro definitions are
known when the offline versions of the kernel are compiled. If the macros are
dynamically specific at runtime, the offline variables should be disabled.</p>
</div>
</div>
<div class="section" id="offline-execution-testing-through-clc">
<a class="header-link" href="#offline-execution-testing-through-clc"><h3 id="offline-execution-testing-through-clc">Offline Execution Testing through CLC</h3><span class="material-icons">link</span></a>
<p>As part of our offline testing, the UnitCL build target will compile OpenCL-C
and SPIR-V kernels through <code class="docutils literal notranslate">clc</code> to produce output binaries that are later
loaded by UnitCL. To control how these are handled, you can add the following
comments to the OpenCL-C kernel. These are parsed by CMake.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate">// CLC OPTIONS:</code> - A semicolon-separated list of values that are to be
passed to <code class="docutils literal notranslate">clc</code> as options. For example <code class="docutils literal notranslate">// CLC OPTIONS:
-cl-mad-enable;-DDEF1=7;-DOPTION_2=ON</code></p></li>
<li><p><code class="docutils literal notranslate">// REQUIRES:</code> - A semi-colon separated list of values representing the
requirements of the kernel. For example <code class="docutils literal notranslate">// REQUIRES: double; images</code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The options defined with <code class="docutils literal notranslate">CLC OPTIONS</code> are also passed to clang as part of
the <a class="reference internal" href="#regenerate-spirv-target">regenerate-spirv target</a>.</p>
</div>
<p>Here is the full list of supported requirements for <code class="docutils literal notranslate">// REQUIRES:</code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate">noclc</code> - Skip all <code class="docutils literal notranslate">clc</code> steps for this kernel. Use this when you have a
kernel that is not supported by <code class="docutils literal notranslate">clc</code>. <code class="docutils literal notranslate">OfflineExecution</code> and
<code class="docutils literal notranslate">OfflineSpirvExecution</code> tests will not work for this kernel if this
requirement is set.</p></li>
<li><p><code class="docutils literal notranslate">nospirv</code> - Skip all SPIR-V generation steps for this kernel. This will
only have an effect if you are running the
<a class="reference internal" href="#regenerate-spirv"><span class="std std-ref">regenerate-spirv</span></a> target. <code class="docutils literal notranslate">SpirvExecution</code> and
<code class="docutils literal notranslate">OfflineSpirvExecution</code> tests will not work for this kernel if this
requirement is set.</p></li>
<li><p><code class="docutils literal notranslate">double</code> - If your kernel requires doubles (i.e., the <code class="docutils literal notranslate">cl_khr_fp64</code>
extension), then CMake will only compile the kernel for targets with the
<code class="docutils literal notranslate">fp64</code> capability.</p></li>
<li><p><code class="docutils literal notranslate">half</code> - If your kernel requires halfs (i.e., the <code class="docutils literal notranslate">cl_khr_fp16</code>
extension), then CMake will only compile the kernel for targets with the
<code class="docutils literal notranslate">fp16</code> capability.</p></li>
<li><p><code class="docutils literal notranslate">images</code> - If your kernel requires image support, then CMake will only
compile the kernel when <code class="docutils literal notranslate">host</code> has images enabled.</p></li>
<li><p><code class="docutils literal notranslate">parameters</code> - Currently tests that are parameterized using macros do not
support any offline compilation (either to IR or to executable). This
requirement disables all but the <code class="docutils literal notranslate">Execution</code> test type.</p></li>
<li><p><code class="docutils literal notranslate">mayfail</code> - Indicates that <code class="docutils literal notranslate">clc</code> may fail to compile this kernel. The
offline binaries are therefore optional.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate">// REQUIRES:</code> is used to disable build steps. It has no effect on which
tests UnitCL attempts to run. When <code class="docutils literal notranslate">noclc</code> or <code class="docutils literal notranslate">nospirv</code> are used, then
the test (in C++) must set the corresponding <code class="docutils literal notranslate">TEST_F_EXECUTION_OPTIONAL</code>
fields to <code class="docutils literal notranslate">KTSDISABLE</code> so the test isn’t generated. For tests requiring
doubles, halfs, or images, it is common for the test (in C++) to
conditionally skip itself if the target doesn’t support the feature.
Otherwise, UnitCL will attempt to run the test, and the test will fail due to
a missing kernel file.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CMake handles image support differently from double and half support;
checking for <code class="docutils literal notranslate">host</code> image support is a work-around.</p>
</div>
<p>When a requirement is not met, CMake will not run <code class="docutils literal notranslate">clc</code>. Instead, it will
create a stub file with the same name that <code class="docutils literal notranslate">clc</code> would have created. The stub
file contains the text <code class="docutils literal notranslate">Skipped due to &lt;reason&gt;</code>. Stub files allow CMake to
check for stale files; if stub files were not used, CMake would need to always
re-parse skipped kernel files in case the requirements had been changed.</p>
<p>The <code class="docutils literal notranslate">install</code> target looks for the <code class="docutils literal notranslate">Skipped</code> text to determine if a kernel
file is a stub.</p>
<p>When UnitCL is built, <code class="docutils literal notranslate">clc</code> is called by the
<a class="reference internal" href="#unitcl-offline-execution-kernels-target">UnitCL-offline-execution-kernels target</a>.</p>
<p>The SPIR-V kernels passed to <code class="docutils literal notranslate">clc</code> are generated by the <a class="reference internal" href="#regenerate-spirv-target">regenerate-spirv
target</a> .</p>
</div>
<div class="section" id="running-tests-using-an-offline-cl-driver">
<a class="header-link" href="#running-tests-using-an-offline-cl-driver"><h3 id="running-tests-using-an-offline-cl-driver">Running tests using an offline CL driver</h3><span class="material-icons">link</span></a>
<p>When <code class="docutils literal notranslate">UnitCL</code> is running against an offline OpenCL driver i.e. no compiler is
available, then tests which require a compiler are skipped. There are two
methods of test an offline version of CL:</p>
<ul class="simple">
<li><p>Build the oneAPI Construction Kit with the CMake option
<span class="target" id="index-0-variable:CA_RUNTIME_COMPILER_ENABLED"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_RUNTIME_COMPILER_ENABLED</code> set to <code class="docutils literal notranslate">OFF</code>.</p></li>
<li><p>Build the oneAPI Construction Kit with the CMake options
<span class="target" id="index-1-variable:CA_RUNTIME_COMPILER_ENABLED"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_RUNTIME_COMPILER_ENABLED</code> set to <code class="docutils literal notranslate">ON</code>, and
<span class="target" id="index-0-variable:CA_COMPILER_ENABLE_DYNAMIC_LOADER"></span><code class="xref cmake cmake-variable docutils literal notranslate">CA_COMPILER_ENABLE_DYNAMIC_LOADER</code> set to <code class="docutils literal notranslate">ON</code>, then set
the environment variable <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate">CA_COMPILER_PATH</code> to the empty string to
disable loading the compiler at runtime.</p></li>
</ul>
</div>
<div class="section" id="copy-kernels-target">
<a class="header-link" href="#copy-kernels-target"><h3 id="copy-kernels-target"><code class="docutils literal notranslate">copy-kernels</code> Target</h3><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">copy-kernels</code> CMake target is built as part of UnitCL. Its purpose is to
copy kernels from the source directory to the build directory so that they are
available in a known location when UnitCL is run.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate">copy-kernels</code> copies all kernels, including those used for regular (not
execution) UnitCL tests.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate">copy-kernels</code> copies stub kernels (stub files that were generated by the
<a class="reference internal" href="#regenerate-spirv-target">regenerate-spirv target</a>) for CMake dependency
tracking reasons. The <code class="docutils literal notranslate">install</code> target contains logic to prevent stub
kernels from being installed.</p>
</div>
<p>The following diagram shows how the <code class="docutils literal notranslate">copy-kernels</code> target works:</p>
<div class="figure align-center" id="id1">
<div class="graphviz"><img class="graphviz" src="../../../_images/graphviz-9e58d200c6317b268bdc33df0265726397a832e7.png"></div>
<p class="caption" id="id1"><span class="caption-text">Compilation flow for <code class="docutils literal notranslate">copy-kernels</code> target (right-click, <code class="docutils literal notranslate">View Image</code> for full size)</span></p>
</div>
<ul class="simple">
<li><p>File paths are relative to the <code class="docutils literal notranslate">UnitCL/</code> directory. Exceptions are paths
with <code class="docutils literal notranslate">&lt;target&gt;</code>, which will be somewhere in the ComputeMux target’s
directory tree, and paths with <code class="docutils literal notranslate">${PROJECT_BINARY_DIR}</code> or
<code class="docutils literal notranslate">${CMAKE_INSTALL_PREFIX}</code>, which point to CMake’s build or install
directories.</p></li>
<li><p>There are currently no hand-written <code class="docutils literal notranslate">.bc32</code> or <code class="docutils literal notranslate">.bc64</code> default kernels in
UnitCL (yellow dashed ellipse), but these are theoretically supported.</p></li>
<li><p>All <code class="docutils literal notranslate">.cmake</code> scripts are in <code class="docutils literal notranslate">UnitCL/cmake/</code>.</p></li>
<li><p>The <code class="docutils literal notranslate">install</code> target is separate from the <code class="docutils literal notranslate">copy-kernels</code> target, but it’s
shown for completeness.</p></li>
</ul>
</div>
<div class="section" id="unitcl-offline-execution-kernels-target">
<a class="header-link" href="#unitcl-offline-execution-kernels-target"><h3 id="unitcl-offline-execution-kernels-target"><code class="docutils literal notranslate">UnitCL-offline-execution-kernels</code> Target</h3><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">UnitCL-offline-execution-kernels</code> CMake target is built as part of
UnitCL. It wraps <code class="docutils literal notranslate">clc</code> and compiles the kernels used by <code class="docutils literal notranslate">OfflineExecution</code>
and <code class="docutils literal notranslate">OfflineSpirvExecution</code> tests for each target device.</p>
<p>The following diagram shows how the <code class="docutils literal notranslate">UnitCL-offline-execution-kernels</code> target
works:</p>
<div class="figure align-center" id="id2">
<div class="graphviz"><img class="graphviz" src="../../../_images/graphviz-5c098aed38913ac738667ff8288b2870104ffc5b.png"></div>
<p class="caption" id="id2"><span class="caption-text">Compilation flow for <code class="docutils literal notranslate">UnitCL-offline-execution-kernels</code> target (right-click, <code class="docutils literal notranslate">View Image</code> for full size)</span></p>
</div>
<ul class="simple">
<li><p>See the diagram in <a class="reference internal" href="#copy-kernels-target">copy-kernels Target</a> for how the
<code class="docutils literal notranslate">${${MUX_TARGET}_UNITCL_KERNEL_FILES}</code> list is populated.</p></li>
<li><p>The <code class="docutils literal notranslate">install</code> target is separate from the
<code class="docutils literal notranslate">UnitCL-offline-execution-kernels</code> target, but it’s shown for completeness.</p></li>
</ul>
</div>
</div>
<div class="section" id="generating-spir-v">
<a class="header-link" href="#generating-spir-v"><h2 id="generating-spir-v">Generating SPIR-V</h2><span class="material-icons">link</span></a>
<p>IR execution tests — <code class="docutils literal notranslate">SpirvExecution</code> and <code class="docutils literal notranslate">OfflineSpirvExecution</code> — use
SPIR-V kernels. The IR kernels do not change often, so they are committed to
the oneAPI Construction Kit repository. To ensure consistency, the IR kernels
are always generated with exactly the same tools.</p>
<p>The <a class="reference internal" href="#regenerate-spirv-target">regenerate-spirv target</a> is used to rebuild IR kernels. It is also
possible to build individual IR kernels <a class="reference internal" href="#manually-generate-spir-v">manually</a>, but since the process is error-prone, committing manually generated
IR kernels to the repository is discouraged.</p>
<div class="section" id="regenerate-spirv-target">
<span id="regenerate-spirv"></span><a class="header-link" href="#regenerate-spirv-target"><h3 id="regenerate-spirv-target"><code class="docutils literal notranslate">regenerate-spirv</code> Target</h3><span class="material-icons">link</span></a>
<p>There is a custom target - <code class="docutils literal notranslate">regenerate-spirv</code> - which can be used for
generating the appropriate SPIR-V ASM files from all the kernels we have in
UnitCL.</p>
<p>To use the <code class="docutils literal notranslate">regenerate-spirv</code> target you will require the <code class="docutils literal notranslate">llvm-spirv</code>
tool.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/KhronosGroup/SPIRV-LLVM-Translator/">llvm-spirv</a> (See <a class="reference external" href="../../../developer-guide.html#compiling-llvm-spirv">Compiling LLVM-SPIRV</a> for build instructions)</p></li>
</ul>
<p>At the time of writing (2019-11-14), the <code class="docutils literal notranslate">llvm-spirv</code> tool used to generate
SPIR-V from OpenCL C was built from the the <code class="docutils literal notranslate">llvm_release_80</code> branch of
SPIRV-LLVM.</p>
<p>As part of your CMake command set the following values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate">CA_EXTERNAL_LLVM_SPIRV</code> the absolute path to the <code class="docutils literal notranslate">llvm-spirv</code>.</p></li>
</ul>
<p>With these set, calling the <code class="docutils literal notranslate">regenerate-spirv</code> target will build SPIR-V for
all the kernels.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate">regenerate-spirv</code> compiles IR kernels into the source directory, <strong>not</strong>
the build directory. However, temporary files are placed into the build
directory (and later deleted).</p>
</div>
<p><code class="docutils literal notranslate">regenerate-spirv</code> will regenerate all binaries for all kernels, <em>even if
those binaries are not required</em>. If a binary is not tracked by <code class="docutils literal notranslate">git</code>, then
that is probably for a good reason. For example, tests for that binary might
not yet exist. It is recommended not to add binaries to <code class="docutils literal notranslate">git</code> unless that is
specifically what you intend to do. Untracked binaries can be removed with</p>
<pre><code class="language-shell"># In UnitCL
git clean -f source/cl/test/UnitCL/kernels/
# In host, if present
git clean -f modules/mux/targets/host/test/UnitCL/kernels/
</code>
</pre>
<p>The following diagram shows how the <code class="docutils literal notranslate">regenerate-spirv</code> target works:</p>
<div class="figure align-center" id="id3">
<div class="graphviz"><img class="graphviz" src="../../../_images/graphviz-8f151aa192e2fd166d7bf75f35704e6042032d93.png"></div>
<p class="caption" id="id3"><span class="caption-text">Compilation flow for the <code class="docutils literal notranslate">regenerate-spirv</code> target (right-click, <code class="docutils literal notranslate">View Image</code> for full size)</span></p>
</div>
<ul class="simple">
<li><p>See the diagram in <a class="reference internal" href="#copy-kernels-target">copy-kernels Target</a> for how the
<code class="docutils literal notranslate">${${MUX_TARGET}_UNITCL_KERNEL_FILES}</code> list is populated.</p></li>
<li><p>All <code class="docutils literal notranslate">.cmake</code> scripts are in <code class="docutils literal notranslate">UnitCL/cmake/</code>.</p></li>
</ul>
</div>
<div class="section" id="manually-generate-spir-v">
<a class="header-link" href="#manually-generate-spir-v"><h3 id="manually-generate-spir-v">Manually generate SPIR-V</h3><span class="material-icons">link</span></a>
<p>The <code class="docutils literal notranslate">regenerate-spirv</code> target is most useful for automating generation of all
the kernels. However, sometimes you might prefer to generate these yourself by
hand.</p>
<p>To generate SPIR-V binaries we use <code class="docutils literal notranslate">llvm-spirv</code>, which works on bitcode files
similar to those generated above. Since <code class="docutils literal notranslate">llvm-spirv</code> is derived from modern
versions of llvm (at the time of writing the earliest maintained version is
based on llvm 7.0) a matching version of clang should be used to generate
different files for SPIR-V generation. The invocation for this is slightly
different:</p>
<pre><code class="language-shell">clang -c -emit-llvm -target spir-unknown-unknown -cl-std=CL1.2   \
      -Xclang -finclude-default-header                           \
      &lt;compile options&gt;                                          \
      -o kernel_name.bc32                                        \
         kernel_name.cl
clang -c -emit-llvm -target spir64-unknown-unknown -cl-std=CL1.2 \
      -Xclang -finclude-default-header                           \
      &lt;compile options&gt;                                          \
      -o kernel_name.bc64                                        \
         kernel_name.cl
</code>
</pre>
<p>This new bitcode file can then be translated into a SPIR-V binary with the
following command:</p>
<pre><code class="language-shell">llvm-spirv kernel_name.bc32  \
        -o kernel_name.spv32
llvm-spirv kernel_name.bc64  \
        -o kernel_name.spv64
</code>
</pre>
<p>We don’t commit the <code class="docutils literal notranslate">spv</code> files to the repository since they don’t commit
well and our workflow is setup assuming we have <code class="docutils literal notranslate">spvasm</code> instead. <code class="docutils literal notranslate">spvasm</code>
is the form of the SPIR-V binary which we can get by using the <code class="docutils literal notranslate">spirv-dis</code>
tool.</p>
<pre><code class="language-shell">spirv-dis kernel_name.spv32    \
       -o kernel_name.spvasm32
spirv-dis kernel_name.spv64    \
       -o kernel_name.spvasm64
</code>
</pre>
</div>
</div>
</div>
</div>
</div></body>
<!-- Mirrored from 127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/test/unitcl.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 22 Sep 2025 18:49:18 GMT -->
</html>
                    <a id="bottom"></a>
                </div>

                <!-- Separator -->
                <div class="separator"></div>

                <!-- Rate -->
                <div id="rate" class="rate collapsed">
                    <div>
                        Rate this Guide
                    </div>
                    <form action="https://formspree.io/f/xzbypbvl" method="post">
                        <input type="hidden" name="subject" value="Guide Feedback" />
                        <input type="hidden" name="product" value="oneAPI" />
                        <input type="hidden" name="variant" value="Construction Kit" />
                        <input type="hidden" name="guide" value="http://127.0.0.1/products/oneapi/construction-kit/4.0.0/guides/source/cl/test/unitcl.html" />

                        <div class="up" title="Thumb up this guide">
                           <i class="material-icons">thumb_up</i>
                       </div>
                        <div class="down" title="Thumb down this guide">
                            <i class="material-icons">thumb_down</i>
                        </div>
                        <div>
                            <input type="text" name="message"
                                   required="required"
                                   minlength="3"
                                   maxlength="1000"
                                   placeholder="How can we improve this guide? (press enter to send)" />
                        </div>
                    </form>
                </div>

                <!-- Separator -->
                <div class="separator"></div>

                <!-- Navigator -->
                <div id="navigator">
                    <div>
                        <a href="../test-2.html#bottom"
                            >
                            <div>
                                <i class="material-icons">navigate_before</i>
                            </div>
                            <div>
                                <h1>Tests</h1>
                            </div>
                        </a>
                    </div>
                    <div>
                        <a href="../../vk-2.html"
                            >
                            <div>
                                <h1>Vulkan</h1>
                            </div>
                            <div>
                                <i class="material-icons">navigate_next</i>
                            </div>
                        </a>
                    </div>
                </div>
            </article>

            <!-- Separator -->
            <div class="separator"></div>

            <!-- Footer Target -->
            <div id="footer-target"></div>
        </div>

        <!-- File Jump List -->
        <div id="jump-list-container" class="sticky styled-scroller">
            <div class="nav-padding">
                <div class="jump-list-container">
                    <h1 class="file-container-title">
                        <span class="material-icons">assignment</span>Jump to Section
                    </h1>
                    <ol class="in-page-jump-list">
                        <li class="heading-1"><a href="#unitcl">UnitCL</a></li>
                        <li class="heading-2"><a href="#target-specific-unitcl-tests">Target-Specific UnitCL Tests</a></li>
                        <li class="heading-2"><a href="#executing-unitcl">Executing UnitCL</a></li>
                        <li class="heading-2"><a href="#unitcl-options">UnitCL Options</a></li>
                        <li class="heading-2"><a href="#default-test-variations">Default Test Variations</a></li>
                        <li class="heading-2"><a href="#kernel-execution-tests">Kernel Execution Tests</a></li>
                        <li class="heading-2"><a href="#generating-spir-v">Generating SPIR-V</a></li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Handle layout resizing here to avoid jumping -->
<script nonce="77d88380a408db027f68ec3445f72e03">
    const resizerCookie = getCookie('CDPRESIZER');
    if (resizerCookie) {
        const cookieValue = JSON.parse(resizerCookie);

        for (let [key, value] of Object.entries(cookieValue)) {
            if (value === null || value === undefined) {
                continue;
            }

            key = atob(key);
            $(':root')[0].style.setProperty('--' + key, value + 'px');
        }
    }
</script>

</main>

<!-- Product Selector-->
<div id="productSelectorDialog" class="popupDialog">
    <div class="side-by-side-panel panel">
        <div id="products">
            <div>
                <h1>Select a Product</h1>
            </div>
            <ul>
                <li>
                    <a class="productSelection oneapi" data-product="oneapi">
                        oneAPI
                    </a>
                </li>
            </ul>
        </div>
        <div id="product-selection">
            <div id="no-product">
                Please select a product
            </div>
            <div id="product">
                <div id="product-oneapi" class="product-view">
                    <h1>

                        oneAPI
                    </h1>
                    <p>oneAPI is a cross-industry, open, standards-based unified programming model that delivers a common developer experience across accelerator architecture - for faster application performance, more productivity, and greater innovation.</p>
                    <ul id="variants">
                        <li>
                            <a href="../../../../../index.html">
                                <div>
                                    Construction Kit
                                </div>
                                <div>
                                    <i class="material-icons">arrow_right</i>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="../../../../../../amd/index.html">
                                <div>
                                    for AMD GPU
                                </div>
                                <div>
                                    <i class="material-icons">arrow_right</i>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="../../../../../../nvidia/index.html">
                                <div>
                                    for NVIDIA® GPUs
                                </div>
                                <div>
                                    <i class="material-icons">arrow_right</i>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Color Scheme Selector-->
<div id="colorSchemeDialog" class="popupDialog">
    <div>
        <div class="selectDarkMode">
            <div>
                <img src="../../../../../../../../assets/img/darkmode.png" alt="Dark Mode" />
            </div>
            <div>
                <i class="material-icons">brightness_2</i>
                <h1>Dark Mode</h1>
                <p>Light text on a dark background.</p>
            </div>
        </div>
        <div class="selectLightMode">
            <div>
                <img src="../../../../../../../../assets/img/lightmode.png" alt="Light Mode" />
            </div>
            <div>
                <i class="material-icons">lightbulb_outline</i>
                <h1>Light Mode</h1>
                <p>Dark text on a light background.</p>
            </div>
        </div>
    </div>
</div>

<!-- Site Selector -->
<div id="siteSelectorDialog" class="popupDialog">
    <div class="panel" id="profile-panel">
        <header>
            <div>
                <i class="material-icons">public</i>
            </div>
            <div>
                <h1>Also,</h1>
                <h2>part of our network</h2>
            </div>
        </header>
        <ul>
            <li>
                <a href="https://www.codeplay.com/" target="_blank" rel="nofollow noopener noreferrer">
                    <h1>Codeplay.com</h1>
                    <p>Find out about Codeplay, the latest company news and blog posts.</p>
                </a>
            </li>
            <li>
                <a href="https://www.sycl.tech/" target="_blank" rel="nofollow noopener noreferrer">
                    <h1>SYCL.tech</h1>
                    <p>Find out about the latest SYCL news, videos and projects.</p>
                </a>
            </li>
            <li class="selected">
                <a>
                    <img src="../../../../../../../../assets/img/you-are-here.png" alt="You Are Here Logo" />
                    <h1>Codeplay Developer</h1>
                    <p>Get the latest documentation and release packages for ComputeCpp and ComputeSuite</p>
                </a>
            </li>
            <li>
                <a href="https://github.com/codeplaysoftware" target="_blank" rel="nofollow noopener noreferrer">
                    <h1>Codeplay Open Source</h1>
                    <p>Browse our open source projects and frameworks on GitHub.</p>
                </a>
            </li>
        </ul>
    </div>
</div>

<!-- Footer section -->
<footer class="section-padding">
    <div class="content-wrapper">
        <div>
            <h1>&copy; Codeplay Software Ltd</h1>
            <div id="copyright"></div>
        </div>
        <div>
            <ul>
                <li><a href="https://codeplay.com/" target="_blank" rel="noopener">
                    Visit codeplay.com</a></li>
                <li><a href="https://codeplay.com/company/privacy/" target="_blank" rel="noopener">
                    View Our Privacy Policy</a></li>
                <li><a href="../../../../../../../../cookies/index.html">
                    Read Our Cookie Policy</a></li>
            </ul>
        </div>
    </div>
</footer>

</body>
</html>